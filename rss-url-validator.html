<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSS URLÊ§úË®º„ÉÑ„Éº„É´ | SCF V5</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: linear-gradient(135deg, #007acc, #1e1e1e);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #007acc;
        }

        h1 {
            color: #4fc3f7;
            font-size: 1.8em;
        }

        .input-section {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #3e3e3e;
        }

        .url-input {
            width: 70%;
            padding: 12px;
            background: #1e1e1e;
            border: 1px solid #007acc;
            color: #d4d4d4;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }

        .check-btn {
            padding: 12px 30px;
            background: #007acc;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
            font-weight: bold;
        }

        .check-btn:hover {
            background: #1e88e5;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 15px;
        }

        .result-card {
            background: #2d2d2d;
            border: 1px solid #3e3e3e;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s;
        }

        .result-card.success {
            border-color: #4caf50;
            background: #1b2e1b;
        }

        .result-card.error {
            border-color: #f44336;
            background: #2e1b1b;
        }

        .result-card.checking {
            border-color: #ffc107;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .url-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .url-title {
            color: #4fc3f7;
            font-weight: bold;
            word-break: break-all;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .status-badge.success {
            background: #4caf50;
            color: white;
        }

        .status-badge.error {
            background: #f44336;
            color: white;
        }

        .status-badge.checking {
            background: #ffc107;
            color: black;
        }

        .url-details {
            margin-top: 10px;
            padding: 10px;
            background: #1e1e1e;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .detail-row {
            display: flex;
            margin-bottom: 5px;
        }

        .detail-label {
            color: #808080;
            width: 120px;
        }

        .detail-value {
            color: #ce9178;
            flex: 1;
            word-break: break-all;
        }

        .suggestions {
            margin-top: 10px;
            padding: 10px;
            background: #1e3a1e;
            border-left: 3px solid #4caf50;
            border-radius: 4px;
        }

        .suggestion-title {
            color: #4caf50;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .suggestion-item {
            color: #9cdcfe;
            margin: 3px 0;
            cursor: pointer;
        }

        .suggestion-item:hover {
            color: #4fc3f7;
            text-decoration: underline;
        }

        .copy-btn {
            padding: 4px 8px;
            background: #3e3e3e;
            border: 1px solid #007acc;
            color: #d4d4d4;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.85em;
            margin-left: 10px;
        }

        .copy-btn:hover {
            background: #007acc;
        }

        .preset-feeds {
            background: #2d2d2d;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #3e3e3e;
        }

        .preset-title {
            color: #4fc3f7;
            margin-bottom: 10px;
        }

        .preset-btn {
            padding: 8px 15px;
            background: #3e3e3e;
            color: #d4d4d4;
            border: 1px solid #007acc;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 0.9em;
        }

        .preset-btn:hover {
            background: #007acc;
        }

        .error-details {
            margin-top: 10px;
            padding: 10px;
            background: #3e1e1e;
            border-left: 3px solid #f44336;
            border-radius: 4px;
            color: #f48771;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç RSS URLÊ§úË®º„ÉÑ„Éº„É´</h1>
            <p>RSS„Éï„Ç£„Éº„ÉâURL„ÅåÊ≠£„Åó„ÅÑ„ÅãÁ¢∫Ë™ç„Åó„ÄÅ‰ª£ÊõøURL„ÇíÊèêÊ°à„Åó„Åæ„Åô</p>
        </div>

        <div class="preset-feeds">
            <div class="preset-title">üìã ÂïèÈ°å„ÅÆ„ÅÇ„Çã„Éï„Ç£„Éº„Éâ„Çí„ÉÅ„Çß„ÉÉ„ÇØ:</div>
            <button class="preset-btn" onclick="checkProblematicFeeds()">ÊîøÂ∫úÁ≥ª„Çµ„Ç§„Éà</button>
            <button class="preset-btn" onclick="checkJapaneseFeeds()">Êó•Êú¨„ÅÆ„Çµ„Ç§„Éà</button>
            <button class="preset-btn" onclick="checkTechFeeds()">ÊäÄË°ìÁ≥ª„Çµ„Ç§„Éà</button>
            <button class="preset-btn" onclick="clearResults()">„ÇØ„É™„Ç¢</button>
        </div>

        <div class="input-section">
            <input type="url" id="urlInput" class="url-input" placeholder="RSS„Éï„Ç£„Éº„ÉâURL„ÇíÂÖ•ÂäõÔºà‰æã: https://example.com/feed.xmlÔºâ">
            <button class="check-btn" onclick="checkSingleUrl()">„ÉÅ„Çß„ÉÉ„ÇØ</button>
        </div>

        <div class="results-grid" id="resultsGrid">
            <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
        </div>
    </div>

    <script>
        // ÂïèÈ°å„ÅÆ„ÅÇ„Çã„Éï„Ç£„Éº„Éâ
        const problematicFeeds = [
            {
                url: 'https://www.enisa.europa.eu/front-page/RSS',
                name: 'ENISA',
                alternatives: [
                    'https://www.enisa.europa.eu/news/rss-feeds',
                    'https://www.enisa.europa.eu/RSS',
                    'https://www.enisa.europa.eu/publications/rss'
                ]
            },
            {
                url: 'https://digital.canada.ca/feed.xml',
                name: 'Digital Canada',
                alternatives: [
                    'https://digital.canada.ca/rss.xml',
                    'https://digital.canada.ca/blog/feed.xml',
                    'https://digital.canada.ca/atom.xml'
                ]
            },
            {
                url: 'https://nrc.canada.ca/en/rss/news',
                name: 'NRC Canada',
                alternatives: [
                    'https://nrc-cnrc.gc.ca/eng/rss/news.xml',
                    'https://www.nrc-cnrc.gc.ca/eng/news/rss.html',
                    'https://nrc.canada.ca/rss/news.xml'
                ]
            },
            {
                url: 'https://digital-strategy.ec.europa.eu/en/news-redirect/rss.xml',
                name: 'EU Digital Strategy',
                alternatives: [
                    'https://digital-strategy.ec.europa.eu/en/feed',
                    'https://ec.europa.eu/digital-single-market/en/news/rss',
                    'https://digital-strategy.ec.europa.eu/news/rss'
                ]
            },
            {
                url: 'https://www.bsi.bund.de/SharedDocs/RSS/DE/BSI-Presse.xml',
                name: 'BSI Germany',
                alternatives: [
                    'https://www.bsi.bund.de/DE/Service/RSS/rss_node.xml',
                    'https://www.bsi.bund.de/DE/Presse/RSS/rss.xml',
                    'https://www.bsi.bund.de/SiteGlobals/Functions/RSSFeed/DE/BSI-RSS.xml'
                ]
            }
        ];

        // Êó•Êú¨„ÅÆ„Éï„Ç£„Éº„Éâ
        const japaneseFeeds = [
            {
                url: 'https://www.ipa.go.jp/about/press/rss/press.xml',
                name: 'IPA',
                alternatives: [
                    'https://www.ipa.go.jp/rss/news.xml',
                    'https://www.ipa.go.jp/security/rss/alert.rdf'
                ]
            },
            {
                url: 'https://www.meti.go.jp/news/rss/index.xml',
                name: 'ÁµåÊ∏àÁî£Ê•≠ÁúÅ',
                alternatives: [
                    'https://www.meti.go.jp/press/rss/index.xml',
                    'https://www.meti.go.jp/feed/index.xml'
                ]
            }
        ];

        async function checkUrl(url, name = null) {
            const resultCard = createResultCard(url, name);
            document.getElementById('resultsGrid').appendChild(resultCard);

            try {
                // 1. Áõ¥Êé•„Ç¢„ÇØ„Çª„ÇπË©¶Ë°å
                const directResponse = await fetch(`https://polished-snow-477a.yutapii.workers.dev?url=${encodeURIComponent(url)}`);
                
                if (directResponse.ok) {
                    const text = await directResponse.text();
                    
                    // RSS/XML„ÉÅ„Çß„ÉÉ„ÇØ
                    if (text.includes('<rss') || text.includes('<feed') || text.includes('<item>') || text.includes('<entry>')) {
                        updateResultCard(resultCard, 'success', {
                            status: '‚úÖ ÊúâÂäπ„Å™RSS',
                            contentType: directResponse.headers.get('content-type') || 'unknown',
                            size: text.length + ' bytes',
                            items: (text.match(/<item>/g) || text.match(/<entry>/g) || []).length + ' Ë®ò‰∫ã'
                        });
                        return true;
                    } else if (text.includes('<!DOCTYPE') || text.includes('<html')) {
                        updateResultCard(resultCard, 'error', {
                            status: '‚ùå HTML„Éö„Éº„Ç∏',
                            error: 'RSS„Éï„Ç£„Éº„Éâ„Åß„ÅØ„Å™„ÅèHTML„Éö„Éº„Ç∏„ÅåËøî„Åï„Çå„Åæ„Åó„Åü',
                            suggestion: 'URL„ÅåÊ≠£„Åó„ÅÑ„ÅãÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ'
                        });
                    } else {
                        updateResultCard(resultCard, 'error', {
                            status: '‚ö†Ô∏è ‰∏çÊòé„Å™ÂΩ¢Âºè',
                            error: 'RSS/XMLÂΩ¢Âºè„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì'
                        });
                    }
                } else {
                    updateResultCard(resultCard, 'error', {
                        status: `‚ùå HTTP ${directResponse.status}`,
                        error: '„Éï„Ç£„Éº„Éâ„Å´„Ç¢„ÇØ„Çª„Çπ„Åß„Åç„Åæ„Åõ„Çì'
                    });
                }

                // 2. ‰ª£ÊõøURL„ÅÆÊèêÊ°à
                const suggestions = generateSuggestions(url);
                if (suggestions.length > 0) {
                    addSuggestions(resultCard, suggestions);
                }

                return false;
            } catch (error) {
                updateResultCard(resultCard, 'error', {
                    status: '‚ùå „Ç®„É©„Éº',
                    error: error.message
                });
                return false;
            }
        }

        function createResultCard(url, name) {
            const card = document.createElement('div');
            card.className = 'result-card checking';
            card.innerHTML = `
                <div class="url-header">
                    <div class="url-title">${name || new URL(url).hostname}</div>
                    <span class="status-badge checking">„ÉÅ„Çß„ÉÉ„ÇØ‰∏≠...</span>
                </div>
                <div class="url-details">
                    <div class="detail-row">
                        <span class="detail-label">URL:</span>
                        <span class="detail-value">${url}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Áä∂ÊÖã:</span>
                        <span class="detail-value status-text">Ê§úË®º‰∏≠...</span>
                    </div>
                </div>
            `;
            return card;
        }

        function updateResultCard(card, status, details) {
            card.className = `result-card ${status}`;
            const badge = card.querySelector('.status-badge');
            badge.className = `status-badge ${status}`;
            badge.textContent = status === 'success' ? 'ÊúâÂäπ' : '„Ç®„É©„Éº';

            const detailsDiv = card.querySelector('.url-details');
            let html = '';
            
            for (const [key, value] of Object.entries(details)) {
                if (key === 'error') {
                    html += `<div class="error-details">${value}</div>`;
                } else {
                    html += `
                        <div class="detail-row">
                            <span class="detail-label">${key}:</span>
                            <span class="detail-value">${value}</span>
                        </div>
                    `;
                }
            }
            
            detailsDiv.innerHTML += html;
        }

        function generateSuggestions(url) {
            const suggestions = [];
            const urlObj = new URL(url);
            const path = urlObj.pathname;
            
            // ‰∏ÄËà¨ÁöÑ„Å™RSS„Éë„Çπ
            const commonPaths = [
                '/rss',
                '/rss.xml',
                '/feed',
                '/feed.xml',
                '/feeds',
                '/atom.xml',
                '/index.xml',
                '/news/rss',
                '/blog/rss',
                '/RSS',
                '/feed.rss'
            ];

            // Ë®ÄË™ûÂà•„Éë„Çπ
            if (url.includes('/en/')) {
                suggestions.push(url.replace('/en/', '/eng/'));
            }
            if (url.includes('/fr/')) {
                suggestions.push(url.replace('/fr/', '/fra/'));
            }
            
            // ‰∏ÄËà¨ÁöÑ„Å™„Éë„Çπ„ÇíË©¶„Åô
            commonPaths.forEach(path => {
                suggestions.push(`${urlObj.origin}${path}`);
            });

            return [...new Set(suggestions)].slice(0, 5);
        }

        function addSuggestions(card, suggestions) {
            const sugDiv = document.createElement('div');
            sugDiv.className = 'suggestions';
            sugDiv.innerHTML = `
                <div class="suggestion-title">üí° ‰ª£ÊõøURLÂÄôË£ú:</div>
                ${suggestions.map(url => `
                    <div class="suggestion-item" onclick="checkUrl('${url}')">${url}</div>
                `).join('')}
            `;
            card.appendChild(sugDiv);
        }

        async function checkProblematicFeeds() {
            clearResults();
            for (const feed of problematicFeeds) {
                await checkUrl(feed.url, feed.name);
                await new Promise(resolve => setTimeout(resolve, 500));
            }
        }

        async function checkJapaneseFeeds() {
            clearResults();
            for (const feed of japaneseFeeds) {
                await checkUrl(feed.url, feed.name);
                await new Promise(resolve => setTimeout(resolve, 500));
            }
        }

        async function checkTechFeeds() {
            clearResults();
            const techFeeds = [
                { url: 'https://techcrunch.com/feed/', name: 'TechCrunch' },
                { url: 'https://www.wired.com/feed/rss', name: 'Wired' },
                { url: 'https://feeds.arstechnica.com/arstechnica/index', name: 'Ars Technica' }
            ];
            for (const feed of techFeeds) {
                await checkUrl(feed.url, feed.name);
                await new Promise(resolve => setTimeout(resolve, 500));
            }
        }

        function checkSingleUrl() {
            const input = document.getElementById('urlInput');
            const url = input.value.trim();
            if (url) {
                checkUrl(url);
            }
        }

        function clearResults() {
            document.getElementById('resultsGrid').innerHTML = '';
        }

        // Enter„Ç≠„Éº„Åß„ÉÅ„Çß„ÉÉ„ÇØ
        document.getElementById('urlInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                checkSingleUrl();
            }
        });
    </script>
</body>
</html>