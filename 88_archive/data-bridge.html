<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‡ãƒ¼ã‚¿ãƒ–ãƒªãƒƒã‚¸ãƒ„ãƒ¼ãƒ« - 05ã‹ã‚‰10ã¸ãƒ‡ãƒ¼ã‚¿è»¢é€</title>
    <style>
        body {
            font-family: -apple-system, system-ui, sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #ff6b6b;
            padding-bottom: 10px;
        }
        .status-box {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            font-family: monospace;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        button {
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .article-preview {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #4ecdc4;
        }
        .article-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        .article-meta {
            color: #666;
            font-size: 0.9em;
        }
        .log {
            background: #2d2d2d;
            color: #0f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ‰ ãƒ‡ãƒ¼ã‚¿ãƒ–ãƒªãƒƒã‚¸ãƒ„ãƒ¼ãƒ«</h1>
        <p>ã“ã®ãƒ„ãƒ¼ãƒ«ã¯05_rss-readerã®ãƒ‡ãƒ¼ã‚¿ã‚’10_rss-to-articleã§ä½¿ãˆã‚‹å½¢å¼ã«å¤‰æ›ã—ã¦è»¢é€ã—ã¾ã™ã€‚</p>
        
        <div class="status-box info">
            ğŸ’¡ ä½¿ã„æ–¹ï¼šã€Œãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã€â†’ã€Œ10ã¸è»¢é€ã€ã®é †ã§ã‚¯ãƒªãƒƒã‚¯
        </div>
        
        <div style="text-align: center; margin: 30px 0;">
            <button onclick="generateTestData()">ğŸ“ ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿70ä»¶ã‚’ç”Ÿæˆ</button>
            <button onclick="transferData()">ğŸš€ ãƒ‡ãƒ¼ã‚¿ã‚’10ã¸è»¢é€</button>
            <button onclick="checkStatus()">ğŸ” ãƒ‡ãƒ¼ã‚¿çŠ¶æ…‹ã‚’ç¢ºèª</button>
            <button onclick="clearAll()">ğŸ—‘ï¸ ã™ã¹ã¦ã‚¯ãƒªã‚¢</button>
        </div>
        
        <div style="text-align: center; margin: 20px 0;">
            <button onclick="window.location.href='05_rss-reader/index.html'">ğŸ“° 05_RSSä¸€è¦§ã¸</button>
            <button onclick="window.location.href='10_rss-to-article.html'">ğŸ”„ 10_RSSâ†’è¨˜äº‹é€£æºã¸</button>
        </div>
        
        <div id="statusMessage"></div>
        <div id="articlePreview"></div>
        <div class="log" id="logOutput"></div>
    </div>

    <script>
        function log(message, type = '') {
            const timestamp = new Date().toLocaleTimeString('ja-JP');
            const logOutput = document.getElementById('logOutput');
            const color = type === 'error' ? '#f00' : type === 'success' ? '#0f0' : '#0ff';
            logOutput.innerHTML += `<span style="color: ${color}">[${timestamp}] ${message}</span>\n`;
            logOutput.scrollTop = logOutput.scrollHeight;
        }

        function generateTestData() {
            log('ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆé–‹å§‹...', 'info');
            
            const categories = ['AI', 'ãƒ­ãƒœãƒƒãƒˆ', 'è‡ªå‹•é‹è»¢', 'é€šä¿¡', 'é‡å­ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿'];
            const topics = [
                'ChatGPT', 'Claude', 'Gemini', 'GPT-4', 'Tesla', 'Waymo', 
                'Boston Dynamics', '5G', '6G', 'Starlink', 'ãƒ¡ã‚¿ãƒãƒ¼ã‚¹', 
                'VR', 'AR', 'ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³', 'Figure', 'Optimus'
            ];
            const sources = ['TechCrunch', 'Gigazine', 'ITmedia', 'WIRED', 'ZDNet', 'Publickey'];
            
            const articles = [];
            const today = new Date();
            
            for (let i = 0; i < 70; i++) {
                const category = categories[i % categories.length];
                const topic = topics[i % topics.length];
                const source = sources[i % sources.length];
                const daysAgo = Math.floor(i / 10);
                const pubDate = new Date(today);
                pubDate.setDate(pubDate.getDate() - daysAgo);
                
                articles.push({
                    id: i + 1,
                    title: `ã€${category}ã€‘${topic}ã®æœ€æ–°å‹•å‘ã¨å°†æ¥å±•æœ› - ${i + 1}`,
                    description: `${topic}ã«é–¢ã™ã‚‹æœ€æ–°ã®ç ”ç©¶é–‹ç™ºçŠ¶æ³ã‚’ãŠä¼ãˆã—ã¾ã™ã€‚${category}åˆ†é‡ã«ãŠã„ã¦é‡è¦ãªé€²å±•ãŒã‚ã‚Šã€æ¥­ç•Œé–¢ä¿‚è€…ã‹ã‚‰æ³¨ç›®ã‚’é›†ã‚ã¦ã„ã¾ã™ã€‚ä»Šå›ã®ç™ºè¡¨ã«ã‚ˆã‚Šã€æŠ€è¡“é©æ–°ãŒåŠ é€Ÿã™ã‚‹ã“ã¨ãŒæœŸå¾…ã•ã‚Œã¦ã„ã¾ã™ã€‚è©³ç´°ãªåˆ†æã¨å°‚é–€å®¶ã®è¦‹è§£ã‚’äº¤ãˆã¦ãŠå±Šã‘ã—ã¾ã™ã€‚`,
                    link: `https://example.com/article-${i + 1}`,
                    pubDate: pubDate.toISOString(),
                    date: pubDate.toLocaleDateString('ja-JP'),
                    source: source,
                    category: category,
                    feedId: (i % 6) + 1,
                    saved: false,
                    summary: `${topic}ã®æŠ€è¡“ãŒæ€¥é€Ÿã«é€²åŒ–ã€‚${category}åˆ†é‡ã§ã®å¿œç”¨ãŒæœŸå¾…ã•ã‚Œã‚‹ã€‚`
                });
            }
            
            // localStorageã«ä¿å­˜ï¼ˆè¤‡æ•°ã®å½¢å¼ã§ï¼‰
            localStorage.setItem('bridge-articles', JSON.stringify(articles));
            localStorage.setItem('test-articles-count', '70');
            localStorage.setItem('test-articles-date', new Date().toISOString());
            
            log(`âœ… ${articles.length}ä»¶ã®ãƒ†ã‚¹ãƒˆè¨˜äº‹ã‚’ç”Ÿæˆã—ã¾ã—ãŸ`, 'success');
            
            // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
            showPreview(articles.slice(0, 3));
            
            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
            const statusMessage = document.getElementById('statusMessage');
            statusMessage.className = 'status-box success';
            statusMessage.innerHTML = `âœ… 70ä»¶ã®ãƒ†ã‚¹ãƒˆè¨˜äº‹ã‚’ç”Ÿæˆå®Œäº†ï¼æ¬¡ã¯ã€Œãƒ‡ãƒ¼ã‚¿ã‚’10ã¸è»¢é€ã€ã‚’ã‚¯ãƒªãƒƒã‚¯`;
        }

        function transferData() {
            log('ãƒ‡ãƒ¼ã‚¿è»¢é€é–‹å§‹...', 'info');
            
            const bridgeData = localStorage.getItem('bridge-articles');
            if (!bridgeData) {
                log('âŒ è»¢é€ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            const articles = JSON.parse(bridgeData);
            log(`${articles.length}ä»¶ã®è¨˜äº‹ã‚’è»¢é€ä¸­...`, 'info');
            
            // IndexedDBã‚’é–‹ã„ã¦è¨˜äº‹ã‚’ä¿å­˜
            const request = indexedDB.open('SCF_V5_DB', 1);
            
            request.onupgradeneeded = (event) => {
                const db = event.target.result;
                log('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–ä¸­...', 'info');
                
                // feeds store
                if (!db.objectStoreNames.contains('feeds')) {
                    const feedStore = db.createObjectStore('feeds', { keyPath: 'id', autoIncrement: true });
                    feedStore.createIndex('name', 'name', { unique: false });
                    log('feedsãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ', 'success');
                }
                
                // articles store
                if (!db.objectStoreNames.contains('articles')) {
                    const articleStore = db.createObjectStore('articles', { keyPath: 'id', autoIncrement: true });
                    articleStore.createIndex('feedId', 'feedId', { unique: false });
                    articleStore.createIndex('pubDate', 'pubDate', { unique: false });
                    log('articlesãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ', 'success');
                }
            };
            
            request.onsuccess = (event) => {
                const db = event.target.result;
                log('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šæˆåŠŸ', 'success');
                
                // ãƒ•ã‚£ãƒ¼ãƒ‰ã‚‚è¿½åŠ 
                const feeds = [
                    { id: 1, name: 'TechCrunch', url: 'https://techcrunch.com/feed/', category: 'AIãƒ»Tech', active: true },
                    { id: 2, name: 'Gigazine', url: 'https://gigazine.net/news/rss_2.0/', category: 'æŠ€è¡“å…¨èˆ¬', active: true },
                    { id: 3, name: 'ITmedia', url: 'https://rss.itmedia.co.jp/rss/2.0/news_bursts.xml', category: 'ITãƒ»é€šä¿¡', active: true },
                    { id: 4, name: 'WIRED', url: 'https://wired.jp/rss/index.xml', category: 'ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼', active: true },
                    { id: 5, name: 'ZDNet', url: 'https://japan.zdnet.com/rss/index.rdf', category: 'ãƒ“ã‚¸ãƒã‚¹IT', active: true },
                    { id: 6, name: 'Publickey', url: 'https://www.publickey1.jp/atom.xml', category: 'é–‹ç™º', active: true }
                ];
                
                const transaction = db.transaction(['feeds', 'articles'], 'readwrite');
                const feedStore = transaction.objectStore('feeds');
                const articleStore = transaction.objectStore('articles');
                
                // ãƒ•ã‚£ãƒ¼ãƒ‰ã‚’è¿½åŠ 
                feeds.forEach(feed => {
                    feedStore.put(feed);
                });
                log(`${feeds.length}å€‹ã®ãƒ•ã‚£ãƒ¼ãƒ‰ã‚’è¿½åŠ `, 'success');
                
                // è¨˜äº‹ã‚’è¿½åŠ 
                let addedCount = 0;
                articles.forEach(article => {
                    const request = articleStore.put(article);
                    request.onsuccess = () => {
                        addedCount++;
                        if (addedCount === articles.length) {
                            log(`âœ… ${addedCount}ä»¶ã®è¨˜äº‹ã‚’IndexedDBã«ä¿å­˜å®Œäº†`, 'success');
                        }
                    };
                });
                
                transaction.oncomplete = () => {
                    log('âœ… ã™ã¹ã¦ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å®Œäº†', 'success');
                    
                    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
                    const statusMessage = document.getElementById('statusMessage');
                    statusMessage.className = 'status-box success';
                    statusMessage.innerHTML = `âœ… ãƒ‡ãƒ¼ã‚¿è»¢é€å®Œäº†ï¼ã€Œ10_RSSâ†’è¨˜äº‹é€£æºã¸ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç¢ºèªã—ã¦ãã ã•ã„`;
                    
                    // localStorage ã«ã‚‚ä¿å­˜ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ï¼‰
                    localStorage.setItem('rss-articles-cache', JSON.stringify(articles));
                    localStorage.setItem('rss-feeds', JSON.stringify(feeds));
                    localStorage.setItem('last-transfer-date', new Date().toISOString());
                };
                
                transaction.onerror = () => {
                    log(`âŒ ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼: ${transaction.error}`, 'error');
                };
            };
            
            request.onerror = () => {
                log(`âŒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼: ${request.error}`, 'error');
            };
        }

        function showPreview(articles) {
            const preview = document.getElementById('articlePreview');
            preview.innerHTML = '<h3>ğŸ“‹ ã‚µãƒ³ãƒ—ãƒ«è¨˜äº‹ï¼ˆæœ€åˆã®3ä»¶ï¼‰</h3>';
            
            articles.forEach(article => {
                preview.innerHTML += `
                    <div class="article-preview">
                        <div class="article-title">${article.title}</div>
                        <div class="article-meta">
                            ğŸ“° ${article.source} | ğŸ“… ${article.date} | ğŸ·ï¸ ${article.category}
                        </div>
                    </div>
                `;
            });
        }

        function checkStatus() {
            log('ãƒ‡ãƒ¼ã‚¿çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯ä¸­...', 'info');
            
            // localStorage ãƒã‚§ãƒƒã‚¯
            const bridgeArticles = localStorage.getItem('bridge-articles');
            const rssFeeds = localStorage.getItem('rss-feeds');
            const cacheArticles = localStorage.getItem('rss-articles-cache');
            
            log(`localStorage:`, 'info');
            log(`  bridge-articles: ${bridgeArticles ? JSON.parse(bridgeArticles).length + 'ä»¶' : 'ãªã—'}`, 'info');
            log(`  rss-feeds: ${rssFeeds ? JSON.parse(rssFeeds).length + 'ä»¶' : 'ãªã—'}`, 'info');
            log(`  rss-articles-cache: ${cacheArticles ? JSON.parse(cacheArticles).length + 'ä»¶' : 'ãªã—'}`, 'info');
            
            // IndexedDB ãƒã‚§ãƒƒã‚¯
            const request = indexedDB.open('SCF_V5_DB', 1);
            request.onsuccess = (event) => {
                const db = event.target.result;
                log(`IndexedDB:`, 'info');
                log(`  ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹: ${db.name} (Version ${db.version})`, 'info');
                log(`  ãƒ†ãƒ¼ãƒ–ãƒ«: ${Array.from(db.objectStoreNames).join(', ')}`, 'info');
                
                if (db.objectStoreNames.contains('articles')) {
                    const transaction = db.transaction(['articles'], 'readonly');
                    const store = transaction.objectStore('articles');
                    const countRequest = store.count();
                    countRequest.onsuccess = () => {
                        log(`  articlesãƒ†ãƒ¼ãƒ–ãƒ«: ${countRequest.result}ä»¶`, 'success');
                    };
                }
                
                if (db.objectStoreNames.contains('feeds')) {
                    const transaction = db.transaction(['feeds'], 'readonly');
                    const store = transaction.objectStore('feeds');
                    const countRequest = store.count();
                    countRequest.onsuccess = () => {
                        log(`  feedsãƒ†ãƒ¼ãƒ–ãƒ«: ${countRequest.result}ä»¶`, 'success');
                    };
                }
            };
        }

        function clearAll() {
            if (confirm('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) {
                localStorage.removeItem('bridge-articles');
                localStorage.removeItem('test-articles-count');
                localStorage.removeItem('test-articles-date');
                localStorage.removeItem('rss-articles-cache');
                localStorage.removeItem('rss-feeds');
                localStorage.removeItem('last-transfer-date');
                
                const deleteRequest = indexedDB.deleteDatabase('SCF_V5_DB');
                deleteRequest.onsuccess = () => {
                    log('âœ… ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'success');
                    document.getElementById('statusMessage').className = 'status-box info';
                    document.getElementById('statusMessage').innerHTML = 'ãƒ‡ãƒ¼ã‚¿ãŒã‚¯ãƒªã‚¢ã•ã‚Œã¾ã—ãŸ';
                    document.getElementById('articlePreview').innerHTML = '';
                };
            }
        }

        // åˆæœŸãƒã‚§ãƒƒã‚¯
        window.onload = () => {
            log('ãƒ‡ãƒ¼ã‚¿ãƒ–ãƒªãƒƒã‚¸ãƒ„ãƒ¼ãƒ«èµ·å‹•', 'success');
            checkStatus();
        };
    </script>
</body>
</html>