<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[07] ğŸ”® ç”ŸããŸAIãƒˆãƒ¬ãƒ³ãƒ‰ãƒãƒƒãƒ— - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è§£æ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        h1 {
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 24px;
        }
        
        .back-btn {
            background: white;
            color: #667eea;
            padding: 10px 20px;
            border-radius: 25px;
            text-decoration: none;
            transition: all 0.3s;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.2);
        }
        
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        
        .container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        /* çµ±è¨ˆãƒãƒ¼ */
        .stats-bar {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .stat-item {
            text-align: center;
            padding: 10px;
            border-left: 3px solid #667eea;
            background: linear-gradient(to right, rgba(102, 126, 234, 0.05), transparent);
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« */
        .controls {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .control-row {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        /* ãƒˆãƒ¬ãƒ³ãƒ‰ãƒãƒƒãƒ—ã‚¨ãƒªã‚¢ */
        .trend-map {
            background: white;
            border-radius: 15px;
            padding: 30px;
            min-height: 500px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        
        /* ãƒ¯ãƒ¼ãƒ‰ã‚¯ãƒ©ã‚¦ãƒ‰ */
        .word-cloud {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            justify-content: center;
            padding: 20px;
            min-height: 400px;
        }
        
        .trend-word {
            padding: 8px 16px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            white-space: nowrap;
        }
        
        /* ãƒˆãƒ¬ãƒ³ãƒ‰ã‚µã‚¤ã‚º */
        .trend-huge {
            font-size: 2.5em;
            font-weight: bold;
            background: linear-gradient(135deg, #ff6b6b, #ffd93d);
            color: white;
        }
        
        .trend-large {
            font-size: 2em;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .trend-medium {
            font-size: 1.5em;
            background: linear-gradient(135deg, #4ecdc4, #44a3aa);
            color: white;
        }
        
        .trend-small {
            font-size: 1.2em;
            background: #f0f0f0;
            color: #666;
        }
        
        .trend-tiny {
            font-size: 0.9em;
            background: #f8f8f8;
            color: #999;
        }
        
        .trend-word:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            z-index: 10;
        }
        
        /* ãƒˆãƒ¬ãƒ³ãƒ‰ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ */
        .trend-status {
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 0.8em;
            padding: 2px 6px;
            border-radius: 10px;
        }
        
        .status-hot {
            background: #ff6b6b;
            color: white;
        }
        
        .status-rising {
            background: #ffd93d;
            color: #333;
        }
        
        .status-new {
            background: #4ecdc4;
            color: white;
        }
        
        /* ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ¸ˆã¿è¨˜äº‹ãƒªã‚¹ãƒˆ */
        .filtered-articles {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            display: none;
        }
        
        .filtered-articles.active {
            display: block;
        }
        
        .article-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            transition: all 0.3s;
        }
        
        .article-item:hover {
            background: #f8f9fa;
            padding-left: 25px;
        }
        
        .article-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .article-meta {
            font-size: 0.9em;
            color: #999;
        }
        
        /* æ™‚ç³»åˆ—ã‚°ãƒ©ãƒ• */
        .timeline-chart {
            height: 200px;
            background: linear-gradient(to top, rgba(102, 126, 234, 0.1), transparent);
            border-radius: 10px;
            margin: 20px 0;
            padding: 20px;
            position: relative;
        }
        
        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° */
        .loading {
            text-align: center;
            padding: 50px;
            color: #999;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid #f0f0f0;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        @media (max-width: 768px) {
            .control-row {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .word-cloud {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1>[07] ğŸ”® ç”ŸããŸAIãƒˆãƒ¬ãƒ³ãƒ‰ãƒãƒƒãƒ—</h1>
            <div style="display: flex; gap: 10px;">
                <a href="../06_database/index.html" class="back-btn">â† [06] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹</a>
                <a href="../08_content-filter/index.html" class="back-btn">â†’ [08] ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</a>
                <a href="../index.html" class="back-btn">ğŸ  ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
            </div>
        </div>
    </div>
    
    <div class="container">
        <!-- çµ±è¨ˆãƒãƒ¼ -->
        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-value" id="totalArticles">0</div>
                <div class="stat-label">åˆ†æè¨˜äº‹æ•°</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="totalTrends">0</div>
                <div class="stat-label">æ¤œå‡ºãƒˆãƒ¬ãƒ³ãƒ‰</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="hotTrends">0</div>
                <div class="stat-label">ğŸ”¥ æ€¥ä¸Šæ˜‡</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="newTrends">0</div>
                <div class="stat-label">ğŸ†• æ–°è¦ãƒˆãƒ¬ãƒ³ãƒ‰</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="updateTime">--:--</div>
                <div class="stat-label">æœ€çµ‚æ›´æ–°</div>
            </div>
        </div>
        
        <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« -->
        <div class="controls">
            <div class="control-row">
                <button class="btn btn-primary" onclick="analyzeTrends()">
                    ğŸ”„ ãƒˆãƒ¬ãƒ³ãƒ‰è§£æå®Ÿè¡Œ
                </button>
                <button class="btn btn-secondary" onclick="changeTimeRange('today')">
                    ä»Šæ—¥
                </button>
                <button class="btn btn-secondary" onclick="changeTimeRange('week')">
                    ä»Šé€±
                </button>
                <button class="btn btn-secondary" onclick="changeTimeRange('month')">
                    ä»Šæœˆ
                </button>
                <button class="btn btn-secondary" onclick="toggleLanguage()">
                    ğŸŒ è¨€èªçµ±åˆ: <span id="langMode">ON</span>
                </button>
                <button class="btn btn-secondary" onclick="showTimeline()">
                    ğŸ“Š æ™‚ç³»åˆ—è¡¨ç¤º
                </button>
            </div>
        </div>
        
        <!-- ãƒˆãƒ¬ãƒ³ãƒ‰ãƒãƒƒãƒ— -->
        <div class="trend-map">
            <div id="wordCloud" class="word-cloud">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’è§£æä¸­...</p>
                </div>
            </div>
        </div>
        
        <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ¸ˆã¿è¨˜äº‹ãƒªã‚¹ãƒˆ -->
        <div id="filteredArticles" class="filtered-articles">
            <h3 style="margin-bottom: 20px; color: #667eea;">é¸æŠãƒˆãƒ¬ãƒ³ãƒ‰ã®è¨˜äº‹</h3>
            <div id="articlesList"></div>
        </div>
    </div>
    
    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let allArticles = [];
        let currentTrends = [];
        let selectedTrend = null;
        let timeRange = 'week';
        let languageIntegration = true;
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadArticlesFromDatabase();
        });
        
        // 06_databaseã‹ã‚‰è¨˜äº‹ã‚’èª­ã¿è¾¼ã¿
        function loadArticlesFromDatabase() {
            try {
                const storedData = localStorage.getItem('06_database_articles');
                if (storedData) {
                    const data = JSON.parse(storedData);
                    allArticles = data.articles || [];
                    document.getElementById('totalArticles').textContent = allArticles.length.toLocaleString();
                    
                    // è‡ªå‹•ã§ãƒˆãƒ¬ãƒ³ãƒ‰è§£æé–‹å§‹
                    if (allArticles.length > 0) {
                        analyzeTrends();
                    }
                } else {
                    showEmptyState();
                }
            } catch (error) {
                console.error('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                showEmptyState();
            }
        }
        
        // ãƒˆãƒ¬ãƒ³ãƒ‰è§£æãƒ¡ã‚¤ãƒ³é–¢æ•°
        function analyzeTrends() {
            if (allArticles.length === 0) {
                showEmptyState();
                return;
            }
            
            // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°: AI/ãƒ­ãƒœãƒƒãƒˆ/è‡ªå‹•é‹è»¢/é€šä¿¡é–¢é€£ã®ã¿
            const relevantArticles = filterRelevantArticles(allArticles);
            
            // æ™‚é–“ç¯„å›²ã§ãƒ•ã‚£ãƒ«ã‚¿
            const filteredArticles = filterByTimeRange(relevantArticles, timeRange);
            
            // ãƒˆãƒ¬ãƒ³ãƒ‰æŠ½å‡º
            const trends = extractTrends(filteredArticles);
            
            // ãƒˆãƒ¬ãƒ³ãƒ‰è¡¨ç¤º
            displayTrends(trends);
            
            // çµ±è¨ˆæ›´æ–°
            updateStats(trends);
        }
        
        // é–¢é€£è¨˜äº‹ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
        function filterRelevantArticles(articles) {
            const relevantKeywords = [
                // AIé–¢é€£
                'ai', 'artificial intelligence', 'äººå·¥çŸ¥èƒ½', 'machine learning', 'æ©Ÿæ¢°å­¦ç¿’',
                'deep learning', 'ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°', 'æ·±å±¤å­¦ç¿’', 'neural', 'ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«',
                'gpt', 'claude', 'gemini', 'llm', 'å¤§è¦æ¨¡è¨€èªãƒ¢ãƒ‡ãƒ«', 'chatbot', 'ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ',
                'ç”Ÿæˆai', 'generative', 'ç”»åƒç”Ÿæˆ', 'stable diffusion', 'midjourney', 'dall-e',
                
                // ãƒ­ãƒœãƒƒãƒˆé–¢é€£
                'robot', 'ãƒ­ãƒœãƒƒãƒˆ', 'ãƒ­ãƒœãƒ†ã‚£ã‚¯ã‚¹', 'robotics', 'è‡ªå‹•åŒ–', 'automation',
                'ãƒ‰ãƒ­ãƒ¼ãƒ³', 'drone', 'ã‚¢ãƒ¼ãƒ ', 'manipulator', 'ç”£æ¥­ç”¨ãƒ­ãƒœãƒƒãƒˆ',
                
                // è‡ªå‹•é‹è»¢é–¢é€£
                'è‡ªå‹•é‹è»¢', 'autonomous', 'self-driving', 'adas', 'é‹è»¢æ”¯æ´',
                'lidar', 'ãƒ©ã‚¤ãƒ€ãƒ¼', 'ã‚»ãƒ³ã‚µãƒ¼', 'sensor', 'tesla', 'waymo',
                
                // é€šä¿¡é–¢é€£
                '5g', '6g', 'é€šä¿¡', 'network', 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯', 'wifi', 'bluetooth',
                'iot', 'edge', 'ã‚¨ãƒƒã‚¸', 'cloud', 'ã‚¯ãƒ©ã‚¦ãƒ‰', 'ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼'
            ];
            
            return articles.filter(article => {
                const text = `${article.title} ${article.description} ${article.category}`.toLowerCase();
                return relevantKeywords.some(keyword => text.includes(keyword.toLowerCase()));
            });
        }
        
        // æ™‚é–“ç¯„å›²ãƒ•ã‚£ãƒ«ã‚¿
        function filterByTimeRange(articles, range) {
            const now = new Date();
            const cutoff = new Date();
            
            switch(range) {
                case 'today':
                    cutoff.setHours(0, 0, 0, 0);
                    break;
                case 'week':
                    cutoff.setDate(now.getDate() - 7);
                    break;
                case 'month':
                    cutoff.setMonth(now.getMonth() - 1);
                    break;
            }
            
            return articles.filter(article => {
                const articleDate = new Date(article.date);
                return articleDate >= cutoff;
            });
        }
        
        // ãƒˆãƒ¬ãƒ³ãƒ‰æŠ½å‡ºã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
        function extractTrends(articles) {
            const wordFrequency = {};
            const wordContext = {};
            const stopWords = new Set([
                'ã®', 'ã«', 'ã‚’', 'ã¯', 'ãŒ', 'ã¨', 'ã§', 'ã¦', 'ãŸ', 'ã™ã‚‹', 'ãªã„', 'ã‚ã‚‹', 'ã“ã¨', 'ã‚‚ã®',
                'the', 'be', 'to', 'of', 'and', 'a', 'in', 'that', 'have', 'i', 'it', 'for', 'not', 'on', 'with'
            ]);
            
            // å˜èªé »åº¦ã‚«ã‚¦ãƒ³ãƒˆ
            articles.forEach(article => {
                const text = `${article.title} ${article.description}`.toLowerCase();
                
                // é‡è¦ãªå›ºæœ‰åè©ã¨ãƒ•ãƒ¬ãƒ¼ã‚ºã‚’æŠ½å‡º
                const patterns = [
                    /chatgpt|gpt-4|gpt-3/gi,
                    /claude|anthropic/gi,
                    /gemini|bard|google ai/gi,
                    /openai/gi,
                    /microsoft|copilot/gi,
                    /stable diffusion|midjourney|dall-e/gi,
                    /hugging face/gi,
                    /meta|llama/gi,
                    /nvidia/gi,
                    /ç”Ÿæˆai|generative ai/gi,
                    /å¤§è¦æ¨¡è¨€èªãƒ¢ãƒ‡ãƒ«|llm/gi,
                    /ç”»åƒç”Ÿæˆ|image generation/gi,
                    /è‡ªå‹•é‹è»¢|autonomous driving/gi,
                    /é‡å­ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿|quantum/gi,
                    /ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³|blockchain/gi
                ];
                
                patterns.forEach(pattern => {
                    const matches = text.match(pattern);
                    if (matches) {
                        matches.forEach(match => {
                            const normalized = normalizeWord(match);
                            wordFrequency[normalized] = (wordFrequency[normalized] || 0) + 1;
                            
                            // ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆè¨˜éŒ²
                            if (!wordContext[normalized]) {
                                wordContext[normalized] = [];
                            }
                            wordContext[normalized].push({
                                title: article.title,
                                date: article.date,
                                source: article.source
                            });
                        });
                    }
                });
                
                // ä¸€èˆ¬çš„ãªé‡è¦å˜èªã‚‚æŠ½å‡º
                const words = text.split(/[\s,ã€‚ã€,.!?;:()ï¼ˆï¼‰ã€Œã€ã€ã€\[\]{}]/)
                    .filter(word => word.length > 2 && !stopWords.has(word.toLowerCase()));
                
                words.forEach(word => {
                    if (/^[a-z0-9]+$/i.test(word) || /^[\u4e00-\u9fa5]+$/.test(word)) {
                        const normalized = normalizeWord(word);
                        wordFrequency[normalized] = (wordFrequency[normalized] || 0) + 0.5;
                    }
                });
            });
            
            // ãƒˆãƒ¬ãƒ³ãƒ‰ã‚¹ã‚³ã‚¢è¨ˆç®—
            const trends = Object.entries(wordFrequency)
                .filter(([word, count]) => count >= 2) // æœ€ä½2å›å‡ºç¾
                .map(([word, count]) => {
                    const context = wordContext[word] || [];
                    const recentCount = context.filter(c => {
                        const date = new Date(c.date);
                        const daysAgo = (new Date() - date) / (1000 * 60 * 60 * 24);
                        return daysAgo <= 3;
                    }).length;
                    
                    // ã‚¹ã‚³ã‚¢è¨ˆç®—ï¼ˆé »åº¦ + æ–°ã—ã•ãƒœãƒ¼ãƒŠã‚¹ï¼‰
                    const score = count + (recentCount * 2);
                    
                    // ãƒˆãƒ¬ãƒ³ãƒ‰ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¤å®š
                    let status = 'normal';
                    if (recentCount > count * 0.5) status = 'hot';
                    else if (recentCount > count * 0.3) status = 'rising';
                    else if (context.length === recentCount) status = 'new';
                    
                    return {
                        word: word,
                        count: count,
                        score: score,
                        status: status,
                        articles: context
                    };
                })
                .sort((a, b) => b.score - a.score)
                .slice(0, 50); // ä¸Šä½50ãƒˆãƒ¬ãƒ³ãƒ‰
            
            return trends;
        }
        
        // å˜èªã®æ­£è¦åŒ–ï¼ˆè¨€èªçµ±åˆï¼‰
        function normalizeWord(word) {
            const mappings = {
                'chatgpt': 'ChatGPT',
                'gpt-4': 'GPT-4',
                'gpt-3': 'GPT-3',
                'claude': 'Claude',
                'anthropic': 'Anthropic',
                'openai': 'OpenAI',
                'gemini': 'Gemini',
                'bard': 'Bard',
                'google ai': 'Google AI',
                'microsoft': 'Microsoft',
                'copilot': 'Copilot',
                'stable diffusion': 'Stable Diffusion',
                'midjourney': 'Midjourney',
                'dall-e': 'DALL-E',
                'hugging face': 'Hugging Face',
                'meta': 'Meta',
                'llama': 'LLaMA',
                'nvidia': 'NVIDIA',
                'ç”Ÿæˆai': 'ç”ŸæˆAI',
                'generative ai': 'ç”ŸæˆAI',
                'äººå·¥çŸ¥èƒ½': 'AI',
                'artificial intelligence': 'AI',
                'æ©Ÿæ¢°å­¦ç¿’': 'Machine Learning',
                'machine learning': 'Machine Learning',
                'æ·±å±¤å­¦ç¿’': 'Deep Learning',
                'deep learning': 'Deep Learning',
                'å¤§è¦æ¨¡è¨€èªãƒ¢ãƒ‡ãƒ«': 'LLM',
                'llm': 'LLM',
                'ç”»åƒç”Ÿæˆ': 'Image Generation',
                'image generation': 'Image Generation',
                'è‡ªå‹•é‹è»¢': 'Autonomous Driving',
                'autonomous driving': 'Autonomous Driving'
            };
            
            const lower = word.toLowerCase();
            return mappings[lower] || word;
        }
        
        // ãƒˆãƒ¬ãƒ³ãƒ‰è¡¨ç¤º
        function displayTrends(trends) {
            const wordCloud = document.getElementById('wordCloud');
            wordCloud.innerHTML = '';
            
            if (trends.length === 0) {
                wordCloud.innerHTML = '<div class="loading">ãƒˆãƒ¬ãƒ³ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</div>';
                return;
            }
            
            currentTrends = trends;
            
            trends.forEach((trend, index) => {
                const wordElement = document.createElement('div');
                wordElement.className = 'trend-word';
                
                // ã‚µã‚¤ã‚ºã‚¯ãƒ©ã‚¹æ±ºå®š
                if (index < 3) wordElement.classList.add('trend-huge');
                else if (index < 8) wordElement.classList.add('trend-large');
                else if (index < 15) wordElement.classList.add('trend-medium');
                else if (index < 30) wordElement.classList.add('trend-small');
                else wordElement.classList.add('trend-tiny');
                
                // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸
                if (trend.status === 'hot') {
                    wordElement.innerHTML = `${trend.word} <span class="trend-status status-hot">ğŸ”¥</span>`;
                } else if (trend.status === 'rising') {
                    wordElement.innerHTML = `${trend.word} <span class="trend-status status-rising">ğŸ“ˆ</span>`;
                } else if (trend.status === 'new') {
                    wordElement.innerHTML = `${trend.word} <span class="trend-status status-new">ğŸ†•</span>`;
                } else {
                    wordElement.textContent = trend.word;
                }
                
                // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
                wordElement.onclick = () => showFilteredArticles(trend);
                
                // ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆãƒ›ãƒãƒ¼æ™‚ã®æƒ…å ±ï¼‰
                wordElement.title = `${trend.count}ä»¶ã®è¨˜äº‹ã§è¨€åŠ`;
                
                wordCloud.appendChild(wordElement);
            });
        }
        
        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ¸ˆã¿è¨˜äº‹è¡¨ç¤º
        function showFilteredArticles(trend) {
            selectedTrend = trend;
            const filteredDiv = document.getElementById('filteredArticles');
            const articlesList = document.getElementById('articlesList');
            
            // ãƒˆãƒ¬ãƒ³ãƒ‰ã«é–¢é€£ã™ã‚‹è¨˜äº‹ã‚’æ¤œç´¢
            const relatedArticles = allArticles.filter(article => {
                const text = `${article.title} ${article.description}`.toLowerCase();
                return text.includes(trend.word.toLowerCase());
            });
            
            // è¨˜äº‹ãƒªã‚¹ãƒˆç”Ÿæˆ
            articlesList.innerHTML = `
                <h4 style="color: #667eea; margin-bottom: 15px;">
                    ã€Œ${trend.word}ã€ã«é–¢ã™ã‚‹è¨˜äº‹ (${relatedArticles.length}ä»¶)
                </h4>
            `;
            
            relatedArticles.slice(0, 20).forEach(article => {
                const item = document.createElement('div');
                item.className = 'article-item';
                item.innerHTML = `
                    <div class="article-title">${article.title}</div>
                    <div class="article-meta">
                        ${article.source} | ${article.date} | ${article.category}
                    </div>
                `;
                articlesList.appendChild(item);
            });
            
            filteredDiv.classList.add('active');
            filteredDiv.scrollIntoView({ behavior: 'smooth' });
        }
        
        // çµ±è¨ˆæ›´æ–°
        function updateStats(trends) {
            document.getElementById('totalTrends').textContent = trends.length;
            document.getElementById('hotTrends').textContent = 
                trends.filter(t => t.status === 'hot').length;
            document.getElementById('newTrends').textContent = 
                trends.filter(t => t.status === 'new').length;
            
            const now = new Date();
            document.getElementById('updateTime').textContent = 
                `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
        }
        
        // æ™‚é–“ç¯„å›²å¤‰æ›´
        function changeTimeRange(range) {
            timeRange = range;
            analyzeTrends();
        }
        
        // è¨€èªçµ±åˆåˆ‡ã‚Šæ›¿ãˆ
        function toggleLanguage() {
            languageIntegration = !languageIntegration;
            document.getElementById('langMode').textContent = languageIntegration ? 'ON' : 'OFF';
            analyzeTrends();
        }
        
        // æ™‚ç³»åˆ—è¡¨ç¤º
        function showTimeline() {
            alert('æ™‚ç³»åˆ—ã‚°ãƒ©ãƒ•æ©Ÿèƒ½ã¯é–‹ç™ºä¸­ã§ã™');
        }
        
        // ç©ºçŠ¶æ…‹è¡¨ç¤º
        function showEmptyState() {
            const wordCloud = document.getElementById('wordCloud');
            wordCloud.innerHTML = `
                <div class="loading">
                    <p>ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>
                    <p style="margin-top: 10px; font-size: 0.9em;">
                        06_databaseã‹ã‚‰è¨˜äº‹ã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„
                    </p>
                </div>
            `;
        }
    </script>
</body>
</html>