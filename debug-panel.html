<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ« - ãƒ‡ãƒ¼ã‚¿ä¿å­˜å ´æ‰€ä¸€è¦§ | SCF V5</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            min-height: 100vh;
        }

        .debug-header {
            background: #2a2a2a;
            padding: 15px 20px;
            border: 1px solid #00ff00;
            border-radius: 5px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .debug-title {
            font-size: 1.5em;
            text-shadow: 0 0 10px #00ff00;
        }

        .timestamp {
            color: #ffff00;
            font-size: 0.9em;
        }

        .debug-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }

        .debug-card {
            background: #2a2a2a;
            border: 1px solid #00ff00;
            border-radius: 5px;
            padding: 15px;
            position: relative;
            overflow: hidden;
        }

        .debug-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #00ff00, transparent);
            animation: scan 2s linear infinite;
        }

        @keyframes scan {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .module-name {
            color: #00ffff;
            font-size: 1.2em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #00ff00;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .storage-info {
            margin: 10px 0;
            padding: 10px;
            background: #1a1a1a;
            border-radius: 3px;
            border-left: 3px solid #ffff00;
        }

        .storage-type {
            color: #ff00ff;
            font-weight: bold;
        }

        .storage-key {
            color: #00ffff;
            margin-top: 5px;
            word-break: break-all;
        }

        .data-preview {
            color: #999;
            font-size: 0.85em;
            margin-top: 5px;
            max-height: 100px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .file-path {
            color: #ffa500;
            margin-top: 10px;
            font-size: 0.9em;
        }

        .api-endpoint {
            color: #ff69b4;
            margin-top: 5px;
            font-size: 0.9em;
        }

        .refresh-btn {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px #00ff00; }
            50% { box-shadow: 0 0 20px #00ff00; }
        }

        .system-stats {
            background: #2a2a2a;
            border: 1px solid #00ff00;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-label {
            color: #999;
            font-size: 0.85em;
            margin-bottom: 5px;
        }

        .stat-value {
            color: #00ff00;
            font-size: 1.5em;
            font-weight: bold;
        }

        .warning {
            color: #ff0000;
            background: rgba(255, 0, 0, 0.1);
            padding: 5px;
            border-radius: 3px;
            margin-top: 10px;
        }

        .success {
            color: #00ff00;
            background: rgba(0, 255, 0, 0.1);
            padding: 5px;
            border-radius: 3px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="debug-header">
        <h1 class="debug-title">ğŸ” SCF V5 Debug Panel - ãƒ‡ãƒ¼ã‚¿ä¿å­˜å ´æ‰€ãƒãƒƒãƒ—</h1>
        <div style="display: flex; gap: 15px; align-items: center;">
            <a href="settings/index.html" style="color: #00ff00; text-decoration: none; padding: 8px 15px; border: 1px solid #00ff00; border-radius: 3px; background: rgba(0, 255, 0, 0.1); transition: all 0.3s;" onmouseover="this.style.background='rgba(0, 255, 0, 0.3)'" onmouseout="this.style.background='rgba(0, 255, 0, 0.1)'">âš™ï¸ è¨­å®šãƒšãƒ¼ã‚¸</a>
            <a href="index.html" style="color: #00ff00; text-decoration: none; padding: 8px 15px; border: 1px solid #00ff00; border-radius: 3px; background: rgba(0, 255, 0, 0.1); transition: all 0.3s;" onmouseover="this.style.background='rgba(0, 255, 0, 0.3)'" onmouseout="this.style.background='rgba(0, 255, 0, 0.1)'">ğŸ  ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
            <div class="timestamp" id="timestamp"></div>
        </div>
    </div>

    <div class="system-stats">
        <div class="stat-item">
            <div class="stat-label">LocalStorageä½¿ç”¨é‡</div>
            <div class="stat-value" id="localStorageSize">0 KB</div>
        </div>
        <div class="stat-item">
            <div class="stat-label">IndexedDBæ•°</div>
            <div class="stat-value" id="indexedDBCount">0</div>
        </div>
        <div class="stat-item">
            <div class="stat-label">ä¿å­˜ã‚­ãƒ¼ç·æ•°</div>
            <div class="stat-value" id="totalKeys">0</div>
        </div>
        <div class="stat-item">
            <div class="stat-label">APIè¨­å®šæ•°</div>
            <div class="stat-value" id="apiCount">0</div>
        </div>
    </div>

    <div class="debug-grid">
        <!-- RSSä¸€è¦§ç®¡ç† -->
        <div class="debug-card">
            <h3 class="module-name">
                <span class="status-indicator"></span>
                RSSä¸€è¦§ç®¡ç† (rss-reader)
            </h3>
            <div class="storage-info">
                <div class="storage-type">ğŸ“ IndexedDB</div>
                <div class="storage-key">Database: SCFV5_RSS (version: 2)</div>
                <div class="storage-key">Store: feeds</div>
                <div class="data-preview" id="rssFeeds">Loading...</div>
            </div>
            <div class="storage-info">
                <div class="storage-type">ğŸ’¾ LocalStorage (Fallback)</div>
                <div class="storage-key">Key: rss-feeds</div>
                <div class="data-preview" id="rssFeedsLocal">Loading...</div>
            </div>
            <div class="file-path">
                ğŸ“‚ <a href="rss-reader/index.html" style="color: #00ffff; text-decoration: none;">/rss-reader/index.html</a>
                <a href="rss-reader/index.html" style="color: #00ff00; text-decoration: none; padding: 3px 8px; border: 1px solid #00ff00; border-radius: 3px; margin-left: 10px; font-size: 0.85em;">é–‹ã â†’</a>
            </div>
        </div>

        <!-- RSSè¨˜äº‹è¡¨ç¤º -->
        <div class="debug-card">
            <h3 class="module-name">
                <span class="status-indicator"></span>
                RSSè¨˜äº‹è¡¨ç¤º (rss-sources)
            </h3>
            <div class="storage-info">
                <div class="storage-type">ğŸ“ IndexedDB</div>
                <div class="storage-key">Database: SCFV5_RSS (version: 2)</div>
                <div class="storage-key">Store: articles</div>
                <div class="data-preview" id="rssArticles">Loading...</div>
            </div>
            <div class="storage-info">
                <div class="storage-type">ğŸŒ API</div>
                <div class="storage-key">Cloudflare Worker</div>
                <div class="api-endpoint" id="workerUrl">Loading...</div>
            </div>
            <div class="file-path">
                ğŸ“‚ <a href="rss-sources/index.html" style="color: #00ffff; text-decoration: none;">/rss-sources/index.html</a>
                <a href="rss-sources/index.html" style="color: #00ff00; text-decoration: none; padding: 3px 8px; border: 1px solid #00ff00; border-radius: 3px; margin-left: 10px; font-size: 0.85em;">é–‹ã â†’</a>
            </div>
        </div>

        <!-- è¨­å®šç®¡ç† -->
        <div class="debug-card">
            <h3 class="module-name">
                <span class="status-indicator"></span>
                è¨­å®šç®¡ç† (settings)
            </h3>
            <div class="storage-info">
                <div class="storage-type">ğŸ’¾ LocalStorage</div>
                <div class="storage-key">Key: openai-api-key</div>
                <div class="data-preview" id="openaiKey">Loading...</div>
            </div>
            <div class="storage-info">
                <div class="storage-type">ğŸ’¾ LocalStorage</div>
                <div class="storage-key">Key: anthropic-api-key</div>
                <div class="data-preview" id="anthropicKey">Loading...</div>
            </div>
            <div class="storage-info">
                <div class="storage-type">ğŸ’¾ LocalStorage</div>
                <div class="storage-key">Key: cloudflare-worker-url</div>
                <div class="data-preview" id="cfWorker">Loading...</div>
            </div>
            <div class="file-path">
                ğŸ“‚ <a href="settings/index.html" style="color: #00ffff; text-decoration: none;">/settings/index.html</a>
                <a href="settings/index.html#api" style="color: #ffff00; text-decoration: none; padding: 5px 12px; border: 2px solid #ffff00; border-radius: 3px; margin-left: 10px; font-size: 0.9em; font-weight: bold; background: rgba(255, 255, 0, 0.1); box-shadow: 0 0 10px rgba(255, 255, 0, 0.5);">âš™ï¸ APIã‚­ãƒ¼è¨­å®šã¸ â†’</a>
            </div>
        </div>

        <!-- è¨˜äº‹ä½œæˆ -->
        <div class="debug-card">
            <h3 class="module-name">
                <span class="status-indicator"></span>
                è¨˜äº‹ä½œæˆ (article)
            </h3>
            <div class="storage-info">
                <div class="storage-type">ğŸ’¾ LocalStorage</div>
                <div class="storage-key">Key: saved-articles</div>
                <div class="data-preview" id="savedArticles">Loading...</div>
            </div>
            <div class="storage-info">
                <div class="storage-type">ğŸ’¾ LocalStorage</div>
                <div class="storage-key">Key: article-templates</div>
                <div class="data-preview" id="articleTemplates">Loading...</div>
            </div>
            <div class="file-path">ğŸ“‚ /article/index.html</div>
        </div>

        <!-- WXRå‡ºåŠ› -->
        <div class="debug-card">
            <h3 class="module-name">
                <span class="status-indicator"></span>
                WXRå‡ºåŠ› (wxr)
            </h3>
            <div class="storage-info">
                <div class="storage-type">ğŸ’¾ LocalStorage</div>
                <div class="storage-key">Key: wxr-export-history</div>
                <div class="data-preview" id="wxrHistory">Loading...</div>
            </div>
            <div class="file-path">ğŸ“‚ /wxr/index.html</div>
        </div>

        <!-- ç”»åƒç”Ÿæˆ -->
        <div class="debug-card">
            <h3 class="module-name">
                <span class="status-indicator"></span>
                ç”»åƒç”Ÿæˆ (image-gen)
            </h3>
            <div class="storage-info">
                <div class="storage-type">ğŸ’¾ LocalStorage</div>
                <div class="storage-key">Key: generated-images</div>
                <div class="data-preview" id="generatedImages">Loading...</div>
            </div>
            <div class="storage-info">
                <div class="storage-type">ğŸŒ API</div>
                <div class="storage-key">DALL-E 3 / Stable Diffusion</div>
                <div class="api-endpoint">Uses: openai-api-key</div>
            </div>
            <div class="file-path">ğŸ“‚ /image-gen/index.html</div>
        </div>

        <!-- ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆ -->
        <div class="debug-card">
            <h3 class="module-name">
                <span class="status-indicator"></span>
                ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆ (thumbnail)
            </h3>
            <div class="storage-info">
                <div class="storage-type">ğŸ’¾ LocalStorage</div>
                <div class="storage-key">Key: thumbnail-templates</div>
                <div class="data-preview" id="thumbnailTemplates">Loading...</div>
            </div>
            <div class="file-path">ğŸ“‚ /thumbnail/index.html</div>
        </div>

        <!-- æŠ•ç¨¿ç®¡ç† -->
        <div class="debug-card">
            <h3 class="module-name">
                <span class="status-indicator"></span>
                æŠ•ç¨¿ç®¡ç† (posts)
            </h3>
            <div class="storage-info">
                <div class="storage-type">ğŸ’¾ LocalStorage</div>
                <div class="storage-key">Key: published-posts</div>
                <div class="data-preview" id="publishedPosts">Loading...</div>
            </div>
            <div class="storage-info">
                <div class="storage-type">ğŸ’¾ LocalStorage</div>
                <div class="storage-key">Key: post-analytics</div>
                <div class="data-preview" id="postAnalytics">Loading...</div>
            </div>
            <div class="file-path">ğŸ“‚ /posts/index.html</div>
        </div>

        <!-- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ -->
        <div class="debug-card">
            <h3 class="module-name">
                <span class="status-indicator"></span>
                ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ (prompt)
            </h3>
            <div class="storage-info">
                <div class="storage-type">ğŸ’¾ LocalStorage</div>
                <div class="storage-key">Key: prompt-templates</div>
                <div class="data-preview" id="promptTemplates">Loading...</div>
            </div>
            <div class="storage-info">
                <div class="storage-type">ğŸ’¾ LocalStorage</div>
                <div class="storage-key">Key: prompt-history</div>
                <div class="data-preview" id="promptHistory">Loading...</div>
            </div>
            <div class="file-path">ğŸ“‚ /prompt/index.html</div>
        </div>

        <!-- å›³è¡¨ç”Ÿæˆ -->
        <div class="debug-card">
            <h3 class="module-name">
                <span class="status-indicator"></span>
                å›³è¡¨ç”Ÿæˆ (chart)
            </h3>
            <div class="storage-info">
                <div class="storage-type">ğŸ’¾ LocalStorage</div>
                <div class="storage-key">Key: chart-data</div>
                <div class="data-preview" id="chartData">Loading...</div>
            </div>
            <div class="file-path">ğŸ“‚ /chart/index.html</div>
        </div>
    </div>

    <button class="refresh-btn" onclick="refreshData()">ğŸ”„ ãƒ‡ãƒ¼ã‚¿æ›´æ–°</button>

    <script>
        // ãƒ‡ãƒ¼ã‚¿å–å¾—ã¨è¡¨ç¤º
        async function loadDebugData() {
            // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—æ›´æ–°
            document.getElementById('timestamp').textContent = new Date().toLocaleString('ja-JP');

            // LocalStorageçµ±è¨ˆ
            let localStorageSize = 0;
            let totalKeys = 0;
            let apiCount = 0;

            // LocalStorageãƒ‡ãƒ¼ã‚¿å–å¾—
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                localStorageSize += (key.length + value.length) * 2; // æ¦‚ç®—ãƒã‚¤ãƒˆæ•°
                totalKeys++;

                // å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º
                switch(key) {
                    case 'rss-feeds':
                        displayData('rssFeedsLocal', value);
                        break;
                    case 'openai-api-key':
                        displayData('openaiKey', value ? 'è¨­å®šæ¸ˆã¿ (****)' : 'æœªè¨­å®š');
                        apiCount++;
                        break;
                    case 'anthropic-api-key':
                        displayData('anthropicKey', value ? 'è¨­å®šæ¸ˆã¿ (****)' : 'æœªè¨­å®š');
                        apiCount++;
                        break;
                    case 'cloudflare-worker-url':
                        displayData('cfWorker', value || 'æœªè¨­å®š');
                        displayData('workerUrl', value || 'æœªè¨­å®š');
                        apiCount++;
                        break;
                    case 'saved-articles':
                        displayData('savedArticles', value);
                        break;
                    case 'article-templates':
                        displayData('articleTemplates', value);
                        break;
                    case 'wxr-export-history':
                        displayData('wxrHistory', value);
                        break;
                    case 'generated-images':
                        displayData('generatedImages', value);
                        break;
                    case 'thumbnail-templates':
                        displayData('thumbnailTemplates', value);
                        break;
                    case 'published-posts':
                        displayData('publishedPosts', value);
                        break;
                    case 'post-analytics':
                        displayData('postAnalytics', value);
                        break;
                    case 'prompt-templates':
                        displayData('promptTemplates', value);
                        break;
                    case 'prompt-history':
                        displayData('promptHistory', value);
                        break;
                    case 'chart-data':
                        displayData('chartData', value);
                        break;
                }
            }

            // IndexedDBæƒ…å ±å–å¾—
            try {
                const dbs = await indexedDB.databases();
                document.getElementById('indexedDBCount').textContent = dbs.length;

                // SCFV5_RSS ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æƒ…å ±
                const request = indexedDB.open('SCFV5_RSS', 2);
                request.onsuccess = (event) => {
                    const db = event.target.result;
                    
                    // feedsæ•°å–å¾—
                    if (db.objectStoreNames.contains('feeds')) {
                        const transaction = db.transaction(['feeds'], 'readonly');
                        const store = transaction.objectStore('feeds');
                        const countRequest = store.count();
                        countRequest.onsuccess = () => {
                            displayData('rssFeeds', `${countRequest.result} ãƒ•ã‚£ãƒ¼ãƒ‰ç™»éŒ²æ¸ˆã¿`);
                        };
                    }

                    // articlesæ•°å–å¾—
                    if (db.objectStoreNames.contains('articles')) {
                        const transaction = db.transaction(['articles'], 'readonly');
                        const store = transaction.objectStore('articles');
                        const countRequest = store.count();
                        countRequest.onsuccess = () => {
                            displayData('rssArticles', `${countRequest.result} è¨˜äº‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ¸ˆã¿`);
                        };
                    }
                };
            } catch (e) {
                console.log('IndexedDBæƒ…å ±å–å¾—ã‚¨ãƒ©ãƒ¼:', e);
            }

            // çµ±è¨ˆæ›´æ–°
            document.getElementById('localStorageSize').textContent = (localStorageSize / 1024).toFixed(1) + ' KB';
            document.getElementById('totalKeys').textContent = totalKeys;
            document.getElementById('apiCount').textContent = apiCount;
        }

        // ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºãƒ˜ãƒ«ãƒ‘ãƒ¼
        function displayData(elementId, data) {
            const element = document.getElementById(elementId);
            if (!element) return;

            if (!data || data === 'undefined') {
                element.innerHTML = '<span style="color: #ff0000;">æœªè¨­å®š</span>';
                return;
            }

            try {
                // JSONã®å ´åˆã¯ãƒ‘ãƒ¼ã‚¹ã—ã¦æ•´å½¢
                const parsed = JSON.parse(data);
                const preview = JSON.stringify(parsed, null, 2).substring(0, 200);
                element.textContent = preview + (data.length > 200 ? '...' : '');
            } catch {
                // JSONã§ãªã„å ´åˆã¯ãã®ã¾ã¾è¡¨ç¤º
                const preview = data.substring(0, 100);
                element.textContent = preview + (data.length > 100 ? '...' : '');
            }
        }

        // ãƒ‡ãƒ¼ã‚¿æ›´æ–°
        function refreshData() {
            loadDebugData();
            const btn = document.querySelector('.refresh-btn');
            btn.textContent = 'âœ… æ›´æ–°å®Œäº†';
            setTimeout(() => {
                btn.textContent = 'ğŸ”„ ãƒ‡ãƒ¼ã‚¿æ›´æ–°';
            }, 1000);
        }

        // åˆæœŸãƒ­ãƒ¼ãƒ‰
        window.addEventListener('load', loadDebugData);

        // è‡ªå‹•æ›´æ–°ï¼ˆ5ç§’ã”ã¨ï¼‰
        setInterval(loadDebugData, 5000);
    </script>
</body>
</html>