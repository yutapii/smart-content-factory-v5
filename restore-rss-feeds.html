<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSS フィード復元ツール</title>
    <style>
        body {
            font-family: system-ui, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        .status-box {
            background: #f5f5f5;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .error-box {
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        button.danger {
            background: linear-gradient(135deg, #f44336, #e91e63);
        }
        button.success {
            background: linear-gradient(135deg, #4caf50, #8bc34a);
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e0e0e0;
        }
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        th {
            background: #f5f5f5;
            font-weight: bold;
        }
        .category-badge {
            background: #e3f2fd;
            color: #1976d2;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
        }
        #log {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
            margin: 20px 0;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
        }
        .log-success { color: #4caf50; }
        .log-error { color: #f44336; }
        .log-info { color: #2196f3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔄 RSS フィード復元ツール</h1>
        
        <div id="currentStatus" class="status-box">
            <h3>現在の状態</h3>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="currentCount">0</div>
                    <div class="stat-label">現在のフィード数</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="masterCount">0</div>
                    <div class="stat-label">マスターファイル数</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="errorCount">0</div>
                    <div class="stat-label">エラーフィード数</div>
                </div>
            </div>
        </div>

        <div class="button-group">
            <button onclick="loadMasterFile()" class="success">📥 マスターファイル読み込み</button>
            <button onclick="restoreAllFeeds()">♻️ 全フィード復元</button>
            <button onclick="mergeMasterFeeds()">🔀 マスターファイルとマージ</button>
            <button onclick="clearAllFeeds()" class="danger">🗑️ 全フィードクリア</button>
            <button onclick="exportCurrentFeeds()">💾 現在のフィードをエクスポート</button>
            <button onclick="checkErrors()">🔍 エラーチェック</button>
            <button onclick="window.location.href='05_rss-reader/index.html'">📰 RSS一覧ページへ</button>
        </div>

        <div id="log">
            <h3>📋 実行ログ</h3>
        </div>

        <div id="feedTable" style="display:none;">
            <h3>📊 フィード一覧</h3>
            <table id="feedsTableContent">
                <thead>
                    <tr>
                        <th>名前</th>
                        <th>カテゴリ</th>
                        <th>URL</th>
                        <th>状態</th>
                    </tr>
                </thead>
                <tbody id="feedsTableBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        // マスターファイルのデータ（91件）
        const masterFeeds = [
            {"name": "GIGAZINE", "url": "https://gigazine.net/news/rss_2.0/", "category": "テクノロジー"},
            {"name": "ITmedia AI+", "url": "https://rss.itmedia.co.jp/rss/2.0/aiplus.xml", "category": "AI・機械学習"},
            {"name": "NIST", "url": "https://www.nist.gov/news-events/news/rss.xml", "category": "G7官公庁 - アメリカ"},
            {"name": "UK Government Digital Service", "url": "https://gds.blog.gov.uk/feed/", "category": "G7官公庁 - イギリス"},
            {"name": "DCMS", "url": "https://www.gov.uk/government/organisations/department-for-digital-culture-media-sport.atom", "category": "G7官公庁 - イギリス"},
            {"name": "UKRI", "url": "https://www.ukri.org/feed/", "category": "G7官公庁 - イギリス"},
            {"name": "European Commission - Digital", "url": "https://digital-strategy.ec.europa.eu/rss.xml", "category": "EU機関"},
            {"name": "Boston Dynamics", "url": "https://www.bostondynamics.com/rss.xml", "category": "ロボット企業"},
            {"name": "Universal Robots", "url": "https://www.universal-robots.com/blog/rss/", "category": "ロボット企業"},
            {"name": "ファナック", "url": "https://www.fanuc.co.jp/rss/news.xml", "category": "ロボット企業"},
            {"name": "安川電機", "url": "https://www.yaskawa.co.jp/rss/news.xml", "category": "ロボット企業"},
            {"name": "ABB Robotics", "url": "https://new.abb.com/news/rss", "category": "ロボット企業"},
            {"name": "KUKA", "url": "https://www.kuka.com/en-de/press/news/rss", "category": "ロボット企業"},
            {"name": "Waymo", "url": "https://waymo.com/blog/rss/", "category": "自動運転企業"},
            {"name": "Cruise", "url": "https://getcruise.com/news/rss/", "category": "自動運転企業"},
            {"name": "Aurora", "url": "https://aurora.tech/blog/rss", "category": "自動運転企業"},
            {"name": "Mobileye", "url": "https://www.mobileye.com/feed/", "category": "自動運転企業"},
            {"name": "Baidu Apollo", "url": "http://apollo.auto/feed.xml", "category": "自動運転企業"},
            {"name": "Tesla", "url": "https://www.tesla.com/blog/rss", "category": "自動運転企業"},
            {"name": "Qualcomm", "url": "https://www.qualcomm.com/news/rss", "category": "通信企業"},
            {"name": "Ericsson", "url": "https://www.ericsson.com/en/news/rss", "category": "通信企業"},
            {"name": "Nokia", "url": "https://www.nokia.com/about-us/news/releases/rss.xml", "category": "通信企業"},
            {"name": "Huawei", "url": "https://www.huawei.com/en/news/rss", "category": "通信企業"},
            {"name": "Cisco", "url": "https://newsroom.cisco.com/c/allnews.rss", "category": "通信企業"},
            {"name": "NTT R&D", "url": "https://www.rd.ntt/rss/", "category": "通信企業"},
            {"name": "White House - Technology", "url": "https://www.whitehouse.gov/feed/", "category": "G7官公庁 - アメリカ"},
            {"name": "FCC", "url": "https://www.fcc.gov/rss/blog/rss.xml", "category": "G7官公庁 - アメリカ"},
            {"name": "NSF", "url": "https://www.nsf.gov/news/RSS/rss.xml", "category": "G7官公庁 - アメリカ"},
            {"name": "デジタル庁", "url": "https://www.digital.go.jp/feed/", "category": "G7官公庁 - 日本"},
            {"name": "総務省", "url": "https://www.soumu.go.jp/news/rss/index.xml", "category": "G7官公庁 - 日本"},
            {"name": "経済産業省", "url": "https://www.meti.go.jp/news/rss/index.xml", "category": "G7官公庁 - 日本"},
            {"name": "NEDO", "url": "https://www.nedo.go.jp/news/rss/index.xml", "category": "G7官公庁 - 日本"},
            {"name": "BMWK", "url": "https://www.bmwk.de/Navigation/DE/Service/RSS/rss.xml", "category": "G7官公庁 - ドイツ"},
            {"name": "BMBF", "url": "https://www.bmbf.de/SiteGlobals/Functions/RSSFeed/BMBF_RSSNewsfeed.xml", "category": "G7官公庁 - ドイツ"},
            {"name": "BSI", "url": "https://www.bsi.bund.de/SharedDocs/RSS/DE/BSI-Presse.xml", "category": "G7官公庁 - ドイツ"},
            {"name": "Ministère de l'Économie", "url": "https://www.economie.gouv.fr/rss/actu", "category": "G7官公庁 - フランス"},
            {"name": "ANSSI", "url": "https://www.ssi.gouv.fr/feed/", "category": "G7官公庁 - フランス"},
            {"name": "Inria", "url": "https://www.inria.fr/fr/feeds/actualites.xml", "category": "G7官公庁 - フランス"},
            {"name": "AGID", "url": "https://www.agid.gov.it/it/rss.xml", "category": "G7官公庁 - イタリア"},
            {"name": "MISE", "url": "https://www.mise.gov.it/index.php/it/?format=feed", "category": "G7官公庁 - イタリア"},
            {"name": "ISED Canada", "url": "https://www.canada.ca/en/innovation-science-economic-development.rss", "category": "G7官公庁 - カナダ"},
            {"name": "Canadian Digital Service", "url": "https://digital.canada.ca/feed.xml", "category": "G7官公庁 - カナダ"},
            {"name": "NRC Canada", "url": "https://nrc.canada.ca/en/rss/news", "category": "G7官公庁 - カナダ"},
            {"name": "European Commission - Digital", "url": "https://digital-strategy.ec.europa.eu/en/news-redirect/rss.xml", "category": "EU機関"},
            {"name": "ENISA", "url": "https://www.enisa.europa.eu/front-page/RSS", "category": "EU機関"},
            {"name": "TechCrunch Japan", "url": "https://techcrunch.com/feed/", "category": "テクノロジー"},
            {"name": "OpenAI Blog", "url": "https://openai.com/news/rss.xml", "category": "AI研究機関"},
            {"name": "Google AI Blog", "url": "https://blog.google/technology/ai/rss/", "category": "AI研究機関"},
            {"name": "DeepMind Blog", "url": "https://deepmind.google/blog/rss.xml", "category": "AI研究機関"},
            {"name": "Microsoft AI Blog", "url": "https://blogs.microsoft.com/ai/feed/", "category": "AI研究機関"},
            {"name": "arXiv AI", "url": "https://export.arxiv.org/rss/cs.AI", "category": "学術論文"},
            {"name": "arXiv Machine Learning", "url": "https://export.arxiv.org/rss/cs.LG", "category": "学術論文"},
            {"name": "arXiv Neural Computing", "url": "https://export.arxiv.org/rss/cs.NE", "category": "学術論文"},
            {"name": "MIT CSAIL News", "url": "https://www.csail.mit.edu/rss.xml", "category": "大学研究機関"},
            {"name": "理化学研究所 AIP", "url": "https://aip.riken.jp/feed/", "category": "日本のAI研究"},
            {"name": "Preferred Networks", "url": "https://tech.preferred.jp/ja/blog/feed/", "category": "日本のAI企業"},
            {"name": "Hugging Face Blog", "url": "https://huggingface.co/blog/feed.xml", "category": "AI企業"},
            {"name": "AWS ML Blog", "url": "https://aws.amazon.com/blogs/machine-learning/feed/", "category": "クラウドAI"},
            {"name": "TechCrunch Japan", "url": "https://jp.techcrunch.com/feed/", "category": "テクノロジー"},
            {"name": "DeepSeek", "url": "https://www.deepseek.com/feed/", "category": "中国AI企業"},
            {"name": "DeepSeek GitHub", "url": "https://github.com/deepseek-ai.atom", "category": "中国AI企業"},
            {"name": "Baidu AI (ERNIE)", "url": "http://ai.baidu.com/rss/", "category": "中国AI企業"},
            {"name": "Baidu Research", "url": "http://research.baidu.com/feed/", "category": "中国AI企業"},
            {"name": "Alibaba Cloud AI", "url": "https://www.alibabacloud.com/blog/feed/", "category": "中国AI企業"},
            {"name": "Alibaba DAMO Academy", "url": "https://damo.alibaba.com/labs/feed/", "category": "中国AI企業"},
            {"name": "ModelScope (Alibaba)", "url": "https://modelscope.cn/api/v1/models/feed.rss", "category": "中国AI企業"},
            {"name": "ByteDance AI Lab", "url": "https://ailab.bytedance.com/feed/", "category": "中国AI企業"},
            {"name": "ByteDance Research", "url": "https://research.bytedance.com/feed/", "category": "中国AI企業"},
            {"name": "Tencent AI Lab", "url": "https://ai.tencent.com/ailab/en/rss/", "category": "中国AI企業"},
            {"name": "Tencent Cloud AI", "url": "https://cloud.tencent.com/developer/feed", "category": "中国AI企業"},
            {"name": "SenseTime", "url": "https://www.sensetime.com/en/news/feed/", "category": "中国AI企業"},
            {"name": "Megvii", "url": "https://en.megvii.com/news/feed/", "category": "中国AI企業"},
            {"name": "iFLYTEK", "url": "https://www.iflytek.com/en/news/rss.xml", "category": "中国AI企業"},
            {"name": "Huawei AI", "url": "https://www.huawei.com/en/news/ai/rss", "category": "中国AI企業"},
            {"name": "JD AI Research", "url": "https://air.jd.com/feed/", "category": "中国AI企業"},
            {"name": "Xiaomi AI", "url": "https://ai.xiaomi.com/feed/", "category": "中国AI企業"},
            {"name": "Zhipu AI", "url": "https://www.zhipuai.cn/feed/", "category": "中国AI企業"},
            {"name": "01.AI (Yi)", "url": "https://01.ai/feed/", "category": "中国AI企業"},
            {"name": "MiniMax", "url": "https://www.minimaxi.com/feed/", "category": "中国AI企業"},
            {"name": "AI科技評論", "url": "https://www.leiphone.com/category/ai/feed", "category": "中国AI関連ニュース"},
            {"name": "36Kr AI", "url": "https://36kr.com/feed/section/ai", "category": "中国AI関連ニュース"},
            {"name": "機器之心", "url": "https://www.jiqizhixin.com/rss", "category": "中国AI関連ニュース"},
            {"name": "量子位", "url": "https://www.qbitai.com/feed", "category": "中国AI関連ニュース"},
            {"name": "PaperWeekly", "url": "https://www.paperweekly.site/feed/", "category": "中国AI関連ニュース"},
            {"name": "中国科学院", "url": "http://www.cas.cn/rss/kydt.xml", "category": "中国政府・研究機関"},
            {"name": "清華大学AI研究院", "url": "https://ai.tsinghua.edu.cn/feed/", "category": "中国政府・研究機関"},
            {"name": "北京大学AI研究院", "url": "https://ai.pku.edu.cn/feed/", "category": "中国政府・研究機関"},
            {"name": "MIIT（工業情報化部）", "url": "https://www.miit.gov.cn/rss/index.xml", "category": "中国政府・研究機関"},
            {"name": "CAC（网信办）", "url": "http://www.cac.gov.cn/rss.xml", "category": "中国政府・研究機関"},
            {"name": "Ledge.ai", "url": "https://ledge.ai/rss/", "category": "AI・機械学習"},
            {"name": "google", "url": "https://news.google.com/rss/topics/CAAqIQgKIhtDQkFTRGdvSUwyMHZNRE5mTTJRU0FtcGhLQUFQAQ?hl=ja&gl=JP&ceid=JP:ja", "category": ""}
        ];

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            const timestamp = new Date().toLocaleTimeString('ja-JP');
            entry.textContent = `[${timestamp}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function updateStats() {
            const currentFeeds = JSON.parse(localStorage.getItem('rss-feeds') || '[]');
            document.getElementById('currentCount').textContent = currentFeeds.length;
            document.getElementById('masterCount').textContent = masterFeeds.length;
            
            // エラー数をカウント
            const errorCount = currentFeeds.filter(feed => 
                (feed.errorType && feed.errorType !== '') || 
                feed.status === 'エラー' || 
                feed.status === '❌ エラー'
            ).length;
            document.getElementById('errorCount').textContent = errorCount;
            
            log(`統計更新: 現在${currentFeeds.length}件、エラー${errorCount}件`, 'info');
        }

        function loadMasterFile() {
            log(`マスターファイル読み込み開始: ${masterFeeds.length}件`, 'info');
            
            // テーブル表示
            const tbody = document.getElementById('feedsTableBody');
            tbody.innerHTML = '';
            
            masterFeeds.forEach(feed => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${feed.name}</td>
                    <td><span class="category-badge">${feed.category || '未分類'}</span></td>
                    <td style="font-size: 12px; max-width: 300px; overflow: hidden; text-overflow: ellipsis;">${feed.url}</td>
                    <td>マスター</td>
                `;
            });
            
            document.getElementById('feedTable').style.display = 'block';
            log(`マスターファイル読み込み完了: ${masterFeeds.length}件のフィードを表示`, 'success');
        }

        function restoreAllFeeds() {
            if (!confirm('現在のフィードを全て削除して、マスターファイルから復元しますか？')) {
                return;
            }
            
            log('全フィード復元開始', 'info');
            
            // マスターファイルの形式に変換
            const feedsForStorage = masterFeeds.map(feed => ({
                ...feed,
                active: true,
                lastChecked: null,
                status: '未テスト',
                errorType: null,
                addedAt: new Date().toISOString()
            }));
            
            localStorage.setItem('rss-feeds', JSON.stringify(feedsForStorage));
            
            updateStats();
            log(`✅ ${masterFeeds.length}件のフィードを復元しました`, 'success');
            
            setTimeout(() => {
                if (confirm('RSS一覧ページに移動しますか？')) {
                    window.location.href = '05_rss-reader/index.html';
                }
            }, 1000);
        }

        function mergeMasterFeeds() {
            log('マージ処理開始', 'info');
            
            const currentFeeds = JSON.parse(localStorage.getItem('rss-feeds') || '[]');
            const currentUrls = new Set(currentFeeds.map(f => f.url));
            
            let addedCount = 0;
            const mergedFeeds = [...currentFeeds];
            
            masterFeeds.forEach(masterFeed => {
                if (!currentUrls.has(masterFeed.url)) {
                    mergedFeeds.push({
                        ...masterFeed,
                        active: true,
                        lastChecked: null,
                        status: '未テスト',
                        errorType: null,
                        addedAt: new Date().toISOString()
                    });
                    addedCount++;
                    log(`追加: ${masterFeed.name}`, 'success');
                }
            });
            
            localStorage.setItem('rss-feeds', JSON.stringify(mergedFeeds));
            
            updateStats();
            log(`✅ マージ完了: ${addedCount}件の新規フィードを追加（合計: ${mergedFeeds.length}件）`, 'success');
        }

        function clearAllFeeds() {
            if (!confirm('本当に全てのフィードを削除しますか？この操作は取り消せません。')) {
                return;
            }
            
            localStorage.removeItem('rss-feeds');
            updateStats();
            log('⚠️ 全フィードを削除しました', 'error');
        }

        function exportCurrentFeeds() {
            const feeds = JSON.parse(localStorage.getItem('rss-feeds') || '[]');
            const dataStr = JSON.stringify(feeds, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `rss-feeds-backup-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            log(`💾 ${feeds.length}件のフィードをエクスポートしました`, 'success');
        }

        function checkErrors() {
            const feeds = JSON.parse(localStorage.getItem('rss-feeds') || '[]');
            
            const errors = feeds.filter(feed => 
                (feed.errorType && feed.errorType !== '') || 
                feed.status === 'エラー' || 
                feed.status === '❌ エラー'
            );
            
            if (errors.length === 0) {
                log('✅ エラーフィードはありません', 'success');
            } else {
                log(`⚠️ ${errors.length}件のエラーフィードが見つかりました:`, 'error');
                errors.forEach(feed => {
                    log(`  - ${feed.name}: ${feed.errorType || feed.status}`, 'error');
                });
            }
        }

        // ページ読み込み時に統計を更新
        window.addEventListener('load', () => {
            updateStats();
            log('RSS フィード復元ツールを起動しました', 'info');
            
            // 現在のフィード数をチェック
            const currentFeeds = JSON.parse(localStorage.getItem('rss-feeds') || '[]');
            if (currentFeeds.length === 0) {
                log('⚠️ 現在フィードが登録されていません。「マスターファイル読み込み」→「全フィード復元」をクリックしてください', 'error');
            }
        });
    </script>
</body>
</html>