<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSS ã‚¨ãƒ©ãƒ¼åˆ†æãƒ¬ãƒãƒ¼ãƒˆ</title>
    <style>
        body {
            font-family: system-ui, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .header {
            background: linear-gradient(135deg, #ff6b6b, #ff8787);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(255,107,107,0.3);
        }
        h1 {
            margin: 0;
            font-size: 2em;
        }
        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        .stat-card.error {
            border-left: 5px solid #f44336;
        }
        .stat-card.success {
            border-left: 5px solid #4caf50;
        }
        .stat-card.warning {
            border-left: 5px solid #ff9800;
        }
        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }
        .stat-label {
            color: #666;
            font-size: 0.9em;
        }
        .analysis-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h2 {
            color: #333;
            border-bottom: 2px solid #ff6b6b;
            padding-bottom: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        th {
            background: #f8f8f8;
            font-weight: bold;
            color: #333;
        }
        .error-type {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        .error-cors { background: #ffebee; color: #c62828; }
        .error-network { background: #e3f2fd; color: #1565c0; }
        .error-parse { background: #fff3e0; color: #e65100; }
        .error-404 { background: #fce4ec; color: #c2185b; }
        .category-badge {
            background: #e3f2fd;
            color: #1976d2;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
        }
        .recommendation {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .action-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .chart-container {
            margin: 20px 0;
            padding: 20px;
            background: #f8f8f8;
            border-radius: 8px;
        }
        .bar {
            height: 30px;
            margin: 10px 0;
            background: linear-gradient(90deg, #4caf50 var(--success), #f44336 var(--error));
            border-radius: 5px;
            position: relative;
            overflow: hidden;
        }
        .bar-label {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“Š RSS ã‚¨ãƒ©ãƒ¼åˆ†æãƒ¬ãƒãƒ¼ãƒˆ</h1>
        <p style="margin: 10px 0 0 0; opacity: 0.9;">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ—¥æ™‚: <span id="testDate"></span></p>
    </div>

    <div class="summary">
        <div class="stat-card success">
            <div class="stat-label">âœ… æˆåŠŸ</div>
            <div class="stat-value" style="color: #4caf50;">25</div>
            <div class="stat-label">27.5%</div>
        </div>
        <div class="stat-card error">
            <div class="stat-label">âŒ ã‚¨ãƒ©ãƒ¼</div>
            <div class="stat-value" style="color: #f44336;">66</div>
            <div class="stat-label">72.5%</div>
        </div>
        <div class="stat-card warning">
            <div class="stat-label">ğŸ”§ è‡ªå‹•ä¿®æ­£</div>
            <div class="stat-value" style="color: #ff9800;">1</div>
            <div class="stat-label">1.1%</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">ğŸ“° ç·è¨˜äº‹æ•°</div>
            <div class="stat-value" style="color: #2196f3;">2111</div>
            <div class="stat-label">æˆåŠŸãƒ•ã‚£ãƒ¼ãƒ‰ã‹ã‚‰</div>
        </div>
    </div>

    <div class="chart-container">
        <h3>æˆåŠŸç‡ã‚°ãƒ©ãƒ•</h3>
        <div class="bar" style="--success: 27.5%; --error: 72.5%;">
            <div class="bar-label">æˆåŠŸ 27.5% | ã‚¨ãƒ©ãƒ¼ 72.5%</div>
        </div>
    </div>

    <div class="analysis-section">
        <h2>ğŸ” ã‚¨ãƒ©ãƒ¼åŸå› åˆ†æ</h2>
        <div id="errorAnalysis"></div>
    </div>

    <div class="analysis-section">
        <h2>ğŸ“‹ ã‚«ãƒ†ã‚´ãƒªåˆ¥ã‚¨ãƒ©ãƒ¼ç‡</h2>
        <div id="categoryAnalysis"></div>
    </div>

    <div class="analysis-section">
        <h2>ğŸ’¡ æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h2>
        <div class="recommendation">
            <h3>ã‚¨ãƒ©ãƒ¼ç‡ãŒé«˜ã„åŸå› ã¨å¯¾ç­–</h3>
            <ul>
                <li><strong>CORS ã‚¨ãƒ©ãƒ¼ï¼ˆæ¨å®š50%ä»¥ä¸Šï¼‰</strong>
                    <ul>
                        <li>å¤šãã®å®˜å…¬åºãƒ»ä¼æ¥­ã‚µã‚¤ãƒˆãŒCORSåˆ¶é™ã‚ã‚Š</li>
                        <li>å¯¾ç­–: CORSå›é¿ã‚µãƒ¼ãƒ“ã‚¹ã®è¨­å®šç¢ºèª</li>
                    </ul>
                </li>
                <li><strong>SSL/è¨¼æ˜æ›¸ã‚¨ãƒ©ãƒ¼</strong>
                    <ul>
                        <li>HTTPSã§ãªã„ã‚µã‚¤ãƒˆã€æœŸé™åˆ‡ã‚Œè¨¼æ˜æ›¸</li>
                        <li>å¯¾ç­–: HTTPã‚µã‚¤ãƒˆã¯ä»£æ›¿URLã‚’æ¤œè¨</li>
                    </ul>
                </li>
                <li><strong>404/ã‚µãƒ¼ãƒ“ã‚¹çµ‚äº†</strong>
                    <ul>
                        <li>å¤ã„RSSãƒ•ã‚£ãƒ¼ãƒ‰URL</li>
                        <li>å¯¾ç­–: æœ€æ–°ã®URLã«æ›´æ–°ã¾ãŸã¯å‰Šé™¤</li>
                    </ul>
                </li>
            </ul>
        </div>
        
        <div class="action-buttons">
            <button onclick="disableAllErrors()">ğŸš« ã‚¨ãƒ©ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ã‚’å…¨ã¦ç„¡åŠ¹åŒ–</button>
            <button onclick="keepOnlySuccess()">âœ… æˆåŠŸãƒ•ã‚£ãƒ¼ãƒ‰ã®ã¿æ®‹ã™</button>
            <button onclick="exportSuccessFeeds()">ğŸ’¾ æˆåŠŸãƒ•ã‚£ãƒ¼ãƒ‰ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
            <button onclick="findAlternatives()">ğŸ”„ ä»£æ›¿ãƒ•ã‚£ãƒ¼ãƒ‰ææ¡ˆ</button>
        </div>
    </div>

    <div class="analysis-section">
        <h2>âœ… æ­£å¸¸å‹•ä½œãƒ•ã‚£ãƒ¼ãƒ‰ï¼ˆ25ä»¶ï¼‰</h2>
        <div id="successFeeds"></div>
    </div>

    <div class="analysis-section">
        <h2>âŒ ã‚¨ãƒ©ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰è©³ç´°ï¼ˆ66ä»¶ï¼‰</h2>
        <div id="errorFeeds"></div>
    </div>

    <script>
        document.getElementById('testDate').textContent = new Date().toLocaleString('ja-JP');

        function analyzeErrors() {
            const feeds = JSON.parse(localStorage.getItem('rss-feeds') || '[]');
            
            // ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—åˆ¥é›†è¨ˆ
            const errorTypes = {};
            const categoryErrors = {};
            const successList = [];
            const errorList = [];
            
            feeds.forEach(feed => {
                const hasError = (feed.errorType && feed.errorType !== '') || 
                                feed.status === 'ã‚¨ãƒ©ãƒ¼' || 
                                feed.status === 'âŒ ã‚¨ãƒ©ãƒ¼';
                
                if (hasError) {
                    errorList.push(feed);
                    const type = feed.errorType || 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¨ãƒ©ãƒ¼';
                    errorTypes[type] = (errorTypes[type] || 0) + 1;
                    
                    const category = feed.category || 'æœªåˆ†é¡';
                    if (!categoryErrors[category]) {
                        categoryErrors[category] = { error: 0, total: 0 };
                    }
                    categoryErrors[category].error++;
                    categoryErrors[category].total++;
                } else if (feed.status === 'âœ… OK' || feed.status === 'OK') {
                    successList.push(feed);
                    const category = feed.category || 'æœªåˆ†é¡';
                    if (!categoryErrors[category]) {
                        categoryErrors[category] = { error: 0, total: 0 };
                    }
                    categoryErrors[category].total++;
                }
            });
            
            // ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—è¡¨ç¤º
            let errorHtml = '<table><thead><tr><th>ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—</th><th>ä»¶æ•°</th><th>å‰²åˆ</th></tr></thead><tbody>';
            Object.entries(errorTypes).sort((a, b) => b[1] - a[1]).forEach(([type, count]) => {
                const percentage = ((count / errorList.length) * 100).toFixed(1);
                errorHtml += `<tr><td>${type}</td><td>${count}</td><td>${percentage}%</td></tr>`;
            });
            errorHtml += '</tbody></table>';
            document.getElementById('errorAnalysis').innerHTML = errorHtml;
            
            // ã‚«ãƒ†ã‚´ãƒªåˆ¥è¡¨ç¤º
            let categoryHtml = '<table><thead><tr><th>ã‚«ãƒ†ã‚´ãƒª</th><th>ã‚¨ãƒ©ãƒ¼/ç·æ•°</th><th>ã‚¨ãƒ©ãƒ¼ç‡</th></tr></thead><tbody>';
            Object.entries(categoryErrors).sort((a, b) => b[1].error - a[1].error).forEach(([category, stats]) => {
                const errorRate = ((stats.error / stats.total) * 100).toFixed(1);
                const barColor = errorRate > 70 ? '#f44336' : errorRate > 30 ? '#ff9800' : '#4caf50';
                categoryHtml += `<tr>
                    <td><span class="category-badge">${category}</span></td>
                    <td>${stats.error} / ${stats.total}</td>
                    <td><strong style="color: ${barColor}">${errorRate}%</strong></td>
                </tr>`;
            });
            categoryHtml += '</tbody></table>';
            document.getElementById('categoryAnalysis').innerHTML = categoryHtml;
            
            // æˆåŠŸãƒ•ã‚£ãƒ¼ãƒ‰è¡¨ç¤º
            let successHtml = '<table><thead><tr><th>åå‰</th><th>ã‚«ãƒ†ã‚´ãƒª</th><th>è¨˜äº‹æ•°</th></tr></thead><tbody>';
            successList.forEach(feed => {
                successHtml += `<tr>
                    <td>${feed.name}</td>
                    <td><span class="category-badge">${feed.category || 'æœªåˆ†é¡'}</span></td>
                    <td>${feed.articleCount || '-'}</td>
                </tr>`;
            });
            successHtml += '</tbody></table>';
            document.getElementById('successFeeds').innerHTML = successHtml;
            
            // ã‚¨ãƒ©ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰è¡¨ç¤º
            let errorHtml2 = '<table><thead><tr><th>åå‰</th><th>ã‚«ãƒ†ã‚´ãƒª</th><th>ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—</th><th>URL</th></tr></thead><tbody>';
            errorList.forEach(feed => {
                const errorType = feed.errorType || feed.status || 'ã‚¨ãƒ©ãƒ¼';
                errorHtml2 += `<tr>
                    <td>${feed.name}</td>
                    <td><span class="category-badge">${feed.category || 'æœªåˆ†é¡'}</span></td>
                    <td><span class="error-type error-cors">${errorType}</span></td>
                    <td style="font-size: 11px; max-width: 300px; overflow: hidden; text-overflow: ellipsis;">${feed.url}</td>
                </tr>`;
            });
            errorHtml2 += '</tbody></table>';
            document.getElementById('errorFeeds').innerHTML = errorHtml2;
        }

        function disableAllErrors() {
            const feeds = JSON.parse(localStorage.getItem('rss-feeds') || '[]');
            let disabledCount = 0;
            
            feeds.forEach(feed => {
                if ((feed.errorType && feed.errorType !== '') || 
                    feed.status === 'ã‚¨ãƒ©ãƒ¼' || 
                    feed.status === 'âŒ ã‚¨ãƒ©ãƒ¼') {
                    feed.active = false;
                    disabledCount++;
                }
            });
            
            localStorage.setItem('rss-feeds', JSON.stringify(feeds));
            alert(`${disabledCount}ä»¶ã®ã‚¨ãƒ©ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ã‚’ç„¡åŠ¹åŒ–ã—ã¾ã—ãŸ`);
            location.reload();
        }

        function keepOnlySuccess() {
            if (!confirm('ã‚¨ãƒ©ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ã‚’å…¨ã¦å‰Šé™¤ã—ã€æˆåŠŸãƒ•ã‚£ãƒ¼ãƒ‰ã®ã¿æ®‹ã—ã¾ã™ã‹ï¼Ÿ')) return;
            
            const feeds = JSON.parse(localStorage.getItem('rss-feeds') || '[]');
            const successFeeds = feeds.filter(feed => 
                feed.status === 'âœ… OK' || feed.status === 'OK'
            );
            
            localStorage.setItem('rss-feeds', JSON.stringify(successFeeds));
            alert(`${successFeeds.length}ä»¶ã®æˆåŠŸãƒ•ã‚£ãƒ¼ãƒ‰ã®ã¿æ®‹ã—ã¾ã—ãŸ`);
            location.reload();
        }

        function exportSuccessFeeds() {
            const feeds = JSON.parse(localStorage.getItem('rss-feeds') || '[]');
            const successFeeds = feeds.filter(feed => 
                feed.status === 'âœ… OK' || feed.status === 'OK'
            );
            
            const exportData = successFeeds.map(feed => ({
                name: feed.name,
                url: feed.url,
                category: feed.category
            }));
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', `working-feeds-${new Date().toISOString().split('T')[0]}.json`);
            linkElement.click();
            
            alert(`${successFeeds.length}ä»¶ã®æˆåŠŸãƒ•ã‚£ãƒ¼ãƒ‰ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ`);
        }

        function findAlternatives() {
            alert('ä»£æ›¿ãƒ•ã‚£ãƒ¼ãƒ‰ææ¡ˆæ©Ÿèƒ½ã¯é–‹ç™ºä¸­ã§ã™ã€‚\n\nã‚¨ãƒ©ãƒ¼ã®å¤šã„ã‚«ãƒ†ã‚´ãƒª:\n- G7å®˜å…¬åºç³»: åˆ¥ã®RSSé…ä¿¡ã‚µãƒ¼ãƒ“ã‚¹ã‚’æ¤œè¨\n- ä¸­å›½AIä¼æ¥­: ãƒ—ãƒ­ã‚­ã‚·çµŒç”±ã§ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’æ¤œè¨\n- EUæ©Ÿé–¢: å…¬å¼APIã®åˆ©ç”¨ã‚’æ¤œè¨');
        }

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«åˆ†æå®Ÿè¡Œ
        analyzeErrors();
    </script>
</body>
</html>