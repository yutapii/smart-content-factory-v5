<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÈÖç‰ø°RSS - Ë®ò‰∫ãË°®Á§∫ | Êó•ÂàäAI„ÇÜ„Åü„Åï„ÇìÊñ∞ËÅû</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans JP', sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 1.8em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .back-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 8px;
            transition: background 0.3s;
        }

        .back-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .control-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .feed-selector {
            flex: 1;
            min-width: 200px;
        }

        .feed-selector select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
            font-size: 14px;
        }

        .search-box {
            flex: 1;
            min-width: 200px;
        }

        .search-box input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        /* Êó•ÂàäAI„ÇÜ„Åü„Åï„ÇìÊñ∞ËÅû 4ÂàÜÈáé„Éï„Ç£„É´„Çø„Éº */
        .main-categories {
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .category-header {
            font-size: 14px;
            color: #666;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .category-filter {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .category-btn {
            padding: 10px 20px;
            border: 2px solid #ddd;
            background: white;
            color: #666;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .category-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .category-btn.active {
            color: white;
            font-weight: 600;
        }

        .category-btn.active[data-category="all"] {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-color: #667eea;
        }

        .category-btn.active[data-category="ai"] {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-color: #667eea;
        }

        .category-btn.active[data-category="robot"] {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            border-color: #f093fb;
        }

        .category-btn.active[data-category="auto"] {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            border-color: #4facfe;
        }

        .category-btn.active[data-category="telecom"] {
            background: linear-gradient(135deg, #43e97b, #38f9d7);
            border-color: #43e97b;
        }

        .category-btn.active[data-category="other"] {
            background: linear-gradient(135deg, #a8a8a8, #636363);
            border-color: #a8a8a8;
        }

        .category-count {
            background: rgba(255,255,255,0.2);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .category-btn:not(.active) .category-count {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        /* Ë®ò‰∫ã„Ç´„ÉÜ„Ç¥„É™„Éê„ÉÉ„Ç∏ */
        .article-category-badge {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-block;
            margin-left: 10px;
        }

        .badge-ai {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .badge-robot {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
        }

        .badge-auto {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: white;
        }

        .badge-telecom {
            background: linear-gradient(135deg, #43e97b, #38f9d7);
            color: white;
        }

        .badge-other {
            background: #e0e0e0;
            color: #666;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .articles-container {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .article-item {
            padding: 20px;
            border-bottom: 1px solid #eee;
            transition: background 0.3s;
            cursor: pointer;
        }

        .article-item:hover {
            background: #f8f9fa;
        }

        .article-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .article-select {
            margin-right: 15px;
        }

        .article-title {
            flex: 1;
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
            text-decoration: none;
            line-height: 1.4;
        }

        .article-title:hover {
            color: #667eea;
        }

        .article-description {
            color: #666;
            font-size: 0.9em;
            line-height: 1.5;
            margin: 10px 0;
        }

        .article-meta {
            display: flex;
            gap: 15px;
            font-size: 0.85em;
            color: #999;
            align-items: center;
        }

        .article-source {
            background: #f0f0f0;
            padding: 2px 8px;
            border-radius: 3px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .empty-state-text {
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .stats-bar {
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-around;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            font-size: 0.85em;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1>üì° ÈÖç‰ø°RSS - Êó•ÂàäAI„ÇÜ„Åü„Åï„ÇìÊñ∞ËÅû</h1>
            <div style="display: flex; align-items: center; gap: 15px;">
                <span id="corsStatus" style="font-size: 0.85em; background: rgba(76, 175, 80, 0.9); color: white; padding: 6px 12px; border-radius: 15px; display: flex; align-items: center; gap: 5px;">
                    üåê CORSÂõûÈÅø: <span id="corsStatusText">Á¢∫Ë™ç‰∏≠...</span>
                </span>
                <a href="../index.html" class="back-btn">‚Üê „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Å∏</a>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Áµ±Ë®à„Éê„Éº -->
        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-value" id="totalArticles">0</div>
                <div class="stat-label">ÂÖ®Ë®ò‰∫ãÊï∞</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="aiArticles">0</div>
                <div class="stat-label">AIÈñ¢ÈÄ£</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="robotArticles">0</div>
                <div class="stat-label">„É≠„Éú„ÉÉ„Éà</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="autoArticles">0</div>
                <div class="stat-label">Ëá™ÂãïÈÅãËª¢</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="telecomArticles">0</div>
                <div class="stat-label">ÈÄö‰ø°</div>
            </div>
        </div>

        <!-- „É°„Ç§„É≥4ÂàÜÈáé„Éï„Ç£„É´„Çø„Éº -->
        <div class="main-categories">
            <div class="category-header">üì∞ Êó•ÂàäAI„ÇÜ„Åü„Åï„ÇìÊñ∞ËÅû - „É°„Ç§„É≥„Ç´„ÉÜ„Ç¥„É™„ÅßÁµû„ÇäËæº„Åø</div>
            <div class="category-filter" id="categoryFilter">
                <button class="category-btn active" data-category="all" onclick="filterByMainCategory('all')">
                    <span>üåê ÂÖ®„Å¶Ë°®Á§∫</span>
                    <span class="category-count" id="count-all">0</span>
                </button>
                <button class="category-btn" data-category="ai" onclick="filterByMainCategory('ai')">
                    <span>ü§ñ AI</span>
                    <span class="category-count" id="count-ai">0</span>
                </button>
                <button class="category-btn" data-category="robot" onclick="filterByMainCategory('robot')">
                    <span>ü¶æ „É≠„Éú„ÉÉ„Éà</span>
                    <span class="category-count" id="count-robot">0</span>
                </button>
                <button class="category-btn" data-category="auto" onclick="filterByMainCategory('auto')">
                    <span>üöó Ëá™ÂãïÈÅãËª¢</span>
                    <span class="category-count" id="count-auto">0</span>
                </button>
                <button class="category-btn" data-category="telecom" onclick="filterByMainCategory('telecom')">
                    <span>üì° ÈÄö‰ø°</span>
                    <span class="category-count" id="count-telecom">0</span>
                </button>
                <button class="category-btn" data-category="other" onclick="filterByMainCategory('other')">
                    <span>üì∞ „Åù„ÅÆ‰ªñ</span>
                    <span class="category-count" id="count-other">0</span>
                </button>
            </div>
        </div>

        <!-- „Ç≥„É≥„Éà„É≠„Éº„É´ -->
        <div class="controls">
            <div class="control-row">
                <div class="feed-selector">
                    <select id="feedSelector">
                        <option value="all">ÂÖ®„Å¶„ÅÆ„Éï„Ç£„Éº„Éâ</option>
                    </select>
                </div>
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Ë®ò‰∫ã„Çí„Ç≠„Éº„ÉØ„Éº„ÉâÊ§úÁ¥¢...">
                </div>
                <button class="btn btn-primary" onclick="fetchArticles()">üîÑ Êõ¥Êñ∞</button>
                <button class="btn btn-secondary" onclick="saveSelectedArticles()">üíæ ÈÅ∏Êäû„Çí‰øùÂ≠ò</button>
            </div>
        </div>

        <!-- Ë®ò‰∫ã‰∏ÄË¶ß -->
        <div class="articles-container" id="articlesContainer">
            <div class="empty-state">
                <div class="empty-state-icon">üì°</div>
                <div class="empty-state-text">Ë®ò‰∫ã„ÇíÂèñÂæó„Åô„Çã„Å´„ÅØ</div>
                <div class="empty-state-text">„Éï„Ç£„Éº„Éâ„ÇíÈÅ∏Êäû„Åó„Å¶Êõ¥Êñ∞„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
            </div>
        </div>
    </div>

    <!-- ÂÖ±ÈÄö„É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£ -->
    <script src="../js/utils.js"></script>
    <script>
        let allArticles = [];
        let displayedArticles = [];
        let savedArticles = [];
        let currentCategoryFilter = 'all';
        let db = null;
        
        // „Ç≠„Éº„ÉØ„Éº„Éâ„Éû„ÉÉ„Éî„É≥„Ç∞ÔºàÊó•ÂàäAI„ÇÜ„Åü„Åï„ÇìÊñ∞ËÅû„ÅÆ4ÂàÜÈáéÔºâ
        const categoryKeywords = {
            ai: [
                'AI', '‰∫∫Â∑•Áü•ËÉΩ', 'ChatGPT', 'GPT', 'Claude', 'Gemini', 'Copilot', 'LLM', 'Ê©üÊ¢∞Â≠¶Áøí',
                '„Éá„Ç£„Éº„Éó„É©„Éº„Éã„É≥„Ç∞', 'Ê∑±Â±§Â≠¶Áøí', '„Éã„É•„Éº„É©„É´„Éç„ÉÉ„Éà', 'OpenAI', 'Anthropic', 'Google AI',
                'ÁîüÊàêAI', 'ÁîªÂÉèAI', 'Èü≥Â£∞AI', 'Stable Diffusion', 'Midjourney', 'DALL-E',
                '„Éá„Éº„Çø„Çµ„Ç§„Ç®„É≥„Çπ', '„Éì„ÉÉ„Ç∞„Éá„Éº„Çø', 'Ëá™ÁÑ∂Ë®ÄË™ûÂá¶ÁêÜ', 'NLP', 'AGI', 'Ê±éÁî®‰∫∫Â∑•Áü•ËÉΩ',
                '„Éó„É≠„É≥„Éó„Éà', '„Éï„Ç°„Ç§„É≥„ÉÅ„É•„Éº„Éã„É≥„Ç∞', '„Éà„É©„É≥„Çπ„Éï„Ç©„Éº„Éû„Éº', 'Transformer',
                'Hugging Face', 'LangChain', 'Vector', 'Embedding', 'RAG'
            ],
            robot: [
                '„É≠„Éú„ÉÉ„Éà', '„É≠„Éú', '„Éâ„É≠„Éº„É≥', '„Ç¢„É≥„Éâ„É≠„Ç§„Éâ', '„Çµ„Ç§„Éú„Éº„Ç∞', '„Éú„ÉÉ„Éà',
                '„Éí„É•„Éº„Éû„Éé„Ç§„Éâ', 'Áî£Ê•≠„É≠„Éú„ÉÉ„Éà', '„Çµ„Éº„Éì„Çπ„É≠„Éú„ÉÉ„Éà', '‰ªãË≠∑„É≠„Éú„ÉÉ„Éà',
                '„Ç¢„Ç∑„Çπ„Éà„Çπ„Éº„ÉÑ', '„Ç≥„Éú„ÉÉ„Éà', 'Boston Dynamics', 'Spot', 'Atlas',
                '„É≠„Éú„ÉÜ„Ç£„ÇØ„Çπ', 'ROS', '„É°„Ç´„Éà„É≠„Éã„ÇØ„Çπ', '„Ç™„Éº„Éà„É°„Éº„Ç∑„Éß„É≥', 'Ëá™ÂãïÂåñ',
                '„Éë„ÉØ„Éº„Éâ„Çπ„Éº„ÉÑ', '„Ç®„ÇØ„ÇΩ„Çπ„Ç±„É´„Éà„É≥', '„ÇΩ„Éï„Éà„É≠„Éú„ÉÉ„Éà', 'ÂçîÂÉç„É≠„Éú„ÉÉ„Éà',
                'AMR', 'AGV', '„É¢„Éì„É™„ÉÜ„Ç£„É≠„Éú„ÉÉ„Éà'
            ],
            auto: [
                'Ëá™ÂãïÈÅãËª¢', 'Ëá™ÂæãËµ∞Ë°å', 'Tesla', '„ÉÜ„Çπ„É©', 'Waymo', 'Cruise', 'Robotaxi',
                'ADAS', '„É¨„Éô„É´2', '„É¨„Éô„É´3', '„É¨„Éô„É´4', '„É¨„Éô„É´5', 'LiDAR', '„É©„Ç§„ÉÄ„Éº',
                'EV', 'ÈõªÊ∞óËá™ÂãïËªä', 'BEV', 'FSD', 'Autopilot', 'MaaS', 'CASE',
                '„Ç≥„Éç„ÇØ„ÉÜ„ÉÉ„Éâ„Ç´„Éº', 'ËªäËºâAI', 'V2X', 'È´òÂ∫¶ÈÅãËª¢ÊîØÊè¥', '„Çª„É≥„Çµ„Éº„Éï„É•„Éº„Ç∏„Éß„É≥',
                '„Éü„É™Ê≥¢„É¨„Éº„ÉÄ„Éº', '„Ç´„É°„É©„Çª„É≥„Çµ„Éº', 'Ëá™ÂãïÈßêËªä', 'OTA', 'ADAS',
                '„É¢„Éì„É™„ÉÜ„Ç£', '„Çπ„Éû„Éº„Éà„Ç´„Éº', 'ÂÆåÂÖ®Ëá™ÂãïÈÅãËª¢'
            ],
            telecom: [
                '5G', '6G', 'ÈÄö‰ø°', '„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ', 'IoT', '„Ç®„ÉÉ„Ç∏„Ç≥„É≥„Éî„É•„Éº„ÉÜ„Ç£„É≥„Ç∞',
                '„ÇØ„É©„Ç¶„Éâ', 'AWS', 'Azure', 'GCP', '„Çµ„Éº„Éê„Éº', '„Éá„Éº„Çø„Çª„É≥„Çø„Éº',
                'Wi-Fi', 'Bluetooth', 'NFC', '„Çª„Ç≠„É•„É™„ÉÜ„Ç£', '„Çµ„Ç§„Éê„Éº„Çª„Ç≠„É•„É™„ÉÜ„Ç£',
                '„Éñ„É≠„ÉÉ„ÇØ„ÉÅ„Çß„Éº„É≥', 'ÈáèÂ≠êÈÄö‰ø°', 'Ë°õÊòüÈÄö‰ø°', 'Starlink', '„Çπ„Çø„Éº„É™„É≥„ÇØ',
                'API', '„Ç§„É≥„Éï„É©', 'CDN', 'VPN', 'ÊöóÂè∑Âåñ', '„Çº„É≠„Éà„É©„Çπ„Éà',
                'SD-WAN', 'NFV', '„É≠„Éº„Ç´„É´5G', 'Beyond 5G', 'Open RAN',
                'ÂÖâ„Éï„Ç°„Ç§„Éê„Éº', 'FTTH', '„É°„Çø„Éê„Éº„ÇπÈÄö‰ø°', 'XRÈÄö‰ø°'
            ]
        };
        
        // Ë®ò‰∫ã„Çí„Ç´„ÉÜ„Ç¥„É™ÂàÜÈ°û
        function categorizeArticle(article) {
            const text = (article.title + ' ' + (article.description || '')).toLowerCase();
            
            // ÂêÑ„Ç´„ÉÜ„Ç¥„É™„ÅÆ„Çπ„Ç≥„Ç¢„ÇíË®àÁÆó
            const scores = {
                ai: 0,
                robot: 0,
                auto: 0,
                telecom: 0
            };
            
            for (const [category, keywords] of Object.entries(categoryKeywords)) {
                for (const keyword of keywords) {
                    if (text.includes(keyword.toLowerCase())) {
                        scores[category] += keyword.length > 5 ? 2 : 1; // Èï∑„ÅÑ„Ç≠„Éº„ÉØ„Éº„Éâ„ÅØÈáç„Åø‰ªò„Åë
                    }
                }
            }
            
            // ÊúÄÈ´ò„Çπ„Ç≥„Ç¢„ÅÆ„Ç´„ÉÜ„Ç¥„É™„ÇíËøî„Åô
            let maxScore = 0;
            let assignedCategory = 'other';
            
            for (const [category, score] of Object.entries(scores)) {
                if (score > maxScore) {
                    maxScore = score;
                    assignedCategory = category;
                }
            }
            
            return maxScore > 0 ? assignedCategory : 'other';
        }
        
        // „É°„Ç§„É≥„Ç´„ÉÜ„Ç¥„É™„Åß„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
        function filterByMainCategory(category) {
            currentCategoryFilter = category;
            
            // „Éú„Çø„É≥„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíÊõ¥Êñ∞
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.category === category) {
                    btn.classList.add('active');
                }
            });
            
            // Ë®ò‰∫ã„Çí„Éï„Ç£„É´„Çø„É™„É≥„Ç∞„Åó„Å¶Ë°®Á§∫
            applyFilters();
        }
        
        // „Ç´„ÉÜ„Ç¥„É™„Ç´„Ç¶„É≥„Éà„ÇíÊõ¥Êñ∞
        function updateCategoryCounts(articles = allArticles) {
            const counts = {
                all: articles.length,
                ai: 0,
                robot: 0,
                auto: 0,
                telecom: 0,
                other: 0
            };
            
            articles.forEach(article => {
                if (!article.category) {
                    article.category = categorizeArticle(article);
                }
                counts[article.category]++;
            });
            
            // „Ç´„Ç¶„É≥„Éà„ÇíË°®Á§∫
            for (const [category, count] of Object.entries(counts)) {
                const element = document.getElementById(`count-${category}`);
                if (element) {
                    element.textContent = count;
                }
            }
            
            // Áµ±Ë®à„Éê„Éº„ÇÇÊõ¥Êñ∞
            // Utils.updateElements„Åß‰∏ÄÊã¨Êõ¥Êñ∞ÔºàÈ´òÈÄüÂåñÔºâ
            Utils.updateElements([
                { element: document.getElementById('totalArticles'), property: 'text', value: counts.all },
                { element: document.getElementById('aiArticles'), property: 'text', value: counts.ai },
                { element: document.getElementById('robotArticles'), property: 'text', value: counts.robot },
                { element: document.getElementById('autoArticles'), property: 'text', value: counts.auto },
                { element: document.getElementById('telecomArticles'), property: 'text', value: counts.telecom }
            ]);
        }
        
        // „Éï„Ç£„É´„Çø„Éº„ÇíÈÅ©Áî®
        function applyFilters() {
            let filtered = [...allArticles];
            
            // „Ç´„ÉÜ„Ç¥„É™„Éï„Ç£„É´„Çø„Éº
            if (currentCategoryFilter !== 'all') {
                filtered = filtered.filter(article => {
                    if (!article.category) {
                        article.category = categorizeArticle(article);
                    }
                    return article.category === currentCategoryFilter;
                });
            }
            
            // Ê§úÁ¥¢„Éï„Ç£„É´„Çø„Éº
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (searchTerm) {
                filtered = filtered.filter(article => {
                    return article.title.toLowerCase().includes(searchTerm) ||
                           (article.description && article.description.toLowerCase().includes(searchTerm)) ||
                           (article.source && article.source.toLowerCase().includes(searchTerm));
                });
            }
            
            displayedArticles = filtered;
            displayArticles(filtered);
        }
        
        // Ë®ò‰∫ãË°®Á§∫
        function displayArticles(articles) {
            const container = document.getElementById('articlesContainer');
            
            // „Ç´„ÉÜ„Ç¥„É™„Ç´„Ç¶„É≥„Éà„ÇíÊõ¥Êñ∞
            updateCategoryCounts(allArticles);
            
            if (articles.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì°</div>
                        <div class="empty-state-text">Ë®ò‰∫ã„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì</div>
                        <div class="empty-state-text">Âà•„ÅÆ„Ç´„ÉÜ„Ç¥„É™„ÇÑÊ§úÁ¥¢Êù°‰ª∂„ÇíË©¶„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
                    </div>
                `;
                return;
            }
            
            // „Ç´„ÉÜ„Ç¥„É™„ÇíÂâ≤„ÇäÂΩì„Å¶
            articles.forEach(article => {
                if (!article.category) {
                    article.category = categorizeArticle(article);
                }
            });
            
            const categoryBadgeClass = {
                ai: 'badge-ai',
                robot: 'badge-robot',
                auto: 'badge-auto',
                telecom: 'badge-telecom',
                other: 'badge-other'
            };
            
            const categoryNames = {
                ai: 'AI',
                robot: '„É≠„Éú„ÉÉ„Éà',
                auto: 'Ëá™ÂãïÈÅãËª¢',
                telecom: 'ÈÄö‰ø°',
                other: '„Åù„ÅÆ‰ªñ'
            };
            
            container.innerHTML = articles.map((article, index) => `
                <div class="article-item">
                    <div class="article-header">
                        <input type="checkbox" class="article-select" data-index="${index}">
                        <a href="${article.link}" target="_blank" class="article-title">
                            ${article.title}
                        </a>
                    </div>
                    <div class="article-description">${article.description || ''}</div>
                    <div class="article-meta">
                        <span class="article-source">${article.source || '‰∏çÊòé'}</span>
                        <span class="article-date">${article.pubDate ? new Date(article.pubDate).toLocaleString('ja-JP') : ''}</span>
                        <span class="article-category-badge ${categoryBadgeClass[article.category]}">
                            ${categoryNames[article.category]}
                        </span>
                    </div>
                </div>
            `).join('');
        }
        
        // Ë®ò‰∫ãÂèñÂæó
        async function fetchArticles() {
            const feedSelector = document.getElementById('feedSelector');
            const selectedFeed = feedSelector.value;
            
            const workerUrl = 'https://polished-snow-477a.yutapii.workers.dev';
            let feedsToFetch = [];
            
            if (selectedFeed === 'all') {
                // ÂÖ®„Å¶„ÅÆ„Éï„Ç£„Éº„Éâ„ÇíÂèñÂæó
                const options = feedSelector.options;
                for (let i = 1; i < options.length; i++) { // index 0„ÅØ„ÄåÂÖ®„Å¶„ÅÆ„Éï„Ç£„Éº„Éâ„Äç„Å™„ÅÆ„Åß„Çπ„Ç≠„ÉÉ„Éó
                    try {
                        const feed = JSON.parse(options[i].value);
                        feedsToFetch.push(feed);
                    } catch (e) {
                        console.error('„Éï„Ç£„Éº„Éâ„ÅÆ„Éë„Éº„Çπ„Ç®„É©„Éº:', e);
                    }
                }
                
                if (feedsToFetch.length === 0) {
                    alert('ÂèñÂæóÂèØËÉΩ„Å™„Éï„Ç£„Éº„Éâ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                    return;
                }
                
                // „Éó„É≠„Ç∞„É¨„ÇπË°®Á§∫
                const container = document.getElementById('articlesContainer');
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">‚è≥</div>
                        <div class="empty-state-text">ÂÖ®„Éï„Ç£„Éº„Éâ„Åã„ÇâË®ò‰∫ã„ÇíÂèñÂæó‰∏≠...</div>
                        <div class="empty-state-text">0 / ${feedsToFetch.length} ÂÆå‰∫Ü</div>
                    </div>
                `;
            } else {
                feedsToFetch = [JSON.parse(selectedFeed)];
            }
            
            allArticles = [];
            let successCount = 0;
            let errorCount = 0;
            
            // ÂêÑ„Éï„Ç£„Éº„Éâ„Åã„ÇâË®ò‰∫ã„ÇíÂèñÂæó
            for (let i = 0; i < feedsToFetch.length; i++) {
                const feed = feedsToFetch[i];
                
                // „Éó„É≠„Ç∞„É¨„ÇπÊõ¥Êñ∞ÔºàÂÖ®„Éï„Ç£„Éº„Éâ„ÅÆÂ†¥ÂêàÔºâ
                if (selectedFeed === 'all') {
                    const container = document.getElementById('articlesContainer');
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">‚è≥</div>
                            <div class="empty-state-text">ÂÖ®„Éï„Ç£„Éº„Éâ„Åã„ÇâË®ò‰∫ã„ÇíÂèñÂæó‰∏≠...</div>
                            <div class="empty-state-text">${i + 1} / ${feedsToFetch.length} Âá¶ÁêÜ‰∏≠</div>
                            <div class="empty-state-text" style="font-size: 0.9em; margin-top: 10px;">
                                ÁèæÂú®: ${feed.name}<br>
                                ÊàêÂäü: ${successCount} / „Ç®„É©„Éº: ${errorCount}
                            </div>
                        </div>
                    `;
                }
                
                try {
                    const response = await fetch(`${workerUrl}?url=${encodeURIComponent(feed.url)}`);
                    const text = await response.text();
                    
                    const parser = new DOMParser();
                    const xml = parser.parseFromString(text, 'text/xml');
                    
                    const items = xml.querySelectorAll('item, entry');
                    const articles = Array.from(items).map(item => {
                        const getElementText = (tagName) => {
                            const elem = item.querySelector(tagName);
                            return elem ? elem.textContent : '';
                        };
                        
                        return {
                            title: getElementText('title'),
                            link: getElementText('link') || getElementText('id'),
                            description: getElementText('description') || getElementText('summary') || getElementText('content'),
                            pubDate: getElementText('pubDate') || getElementText('published') || getElementText('updated'),
                            source: feed.name,
                            feedId: feed.id
                        };
                    });
                    
                    allArticles.push(...articles);
                    successCount++;
                    
                } catch (error) {
                    console.error(`${feed.name}„ÅÆÂèñÂæó„Ç®„É©„Éº:`, error);
                    errorCount++;
                }
                
                // „É¨„Éº„ÉàÂà∂Èôê„ÇíÈÅø„Åë„Çã„Åü„ÇÅÂ∞ë„ÅóÂæÖÊ©üÔºàÂÖ®„Éï„Ç£„Éº„Éâ„ÅÆÂ†¥ÂêàÔºâ
                if (selectedFeed === 'all' && i < feedsToFetch.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
            }
            
            // ÂÖ®Ë®ò‰∫ã„Å´„Ç´„ÉÜ„Ç¥„É™„ÇíÂâ≤„ÇäÂΩì„Å¶
            allArticles.forEach(article => {
                article.category = categorizeArticle(article);
            });
            
            // Êó•‰ªò„Åß„ÇΩ„Éº„ÉàÔºàÊñ∞„Åó„ÅÑÈ†ÜÔºâ
            allArticles.sort((a, b) => {
                const dateA = new Date(a.pubDate || 0);
                const dateB = new Date(b.pubDate || 0);
                return dateB - dateA;
            });
            
            // ÂÆå‰∫Ü„É°„ÉÉ„Çª„Éº„Ç∏ÔºàÂÖ®„Éï„Ç£„Éº„Éâ„ÅÆÂ†¥ÂêàÔºâ
            if (selectedFeed === 'all') {
                console.log(`ÂèñÂæóÂÆå‰∫Ü: ${allArticles.length}‰ª∂„ÅÆË®ò‰∫ã (ÊàêÂäü: ${successCount}, „Ç®„É©„Éº: ${errorCount})`);
            }
            
            applyFilters();
        }
        
        // ÈÅ∏ÊäûË®ò‰∫ã„Çí‰øùÂ≠ò
        function saveSelectedArticles() {
            const checkboxes = document.querySelectorAll('.article-select:checked');
            const selected = Array.from(checkboxes).map(cb => displayedArticles[cb.dataset.index]);
            
            if (selected.length === 0) {
                alert('‰øùÂ≠ò„Åô„ÇãË®ò‰∫ã„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            const saved = JSON.parse(localStorage.getItem('saved-articles') || '[]');
            saved.push(...selected);
            localStorage.setItem('saved-articles', JSON.stringify(saved));
            
            alert(`${selected.length}‰ª∂„ÅÆË®ò‰∫ã„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü`);
        }
        
        // Ê§úÁ¥¢Ê©üËÉΩ
        document.getElementById('searchInput').addEventListener('input', () => {
            applyFilters();
        });
        
        // IndexedDBÂàùÊúüÂåñ
        async function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('SCFV5_RSS', 2);
                
                request.onerror = () => {
                    console.error('DBÊé•Á∂ö„Ç®„É©„Éº');
                    resolve(null);
                };
                
                request.onsuccess = () => {
                    db = request.result;
                    resolve(db);
                };
                
                request.onupgradeneeded = (event) => {
                    db = event.target.result;
                    
                    if (!db.objectStoreNames.contains('feeds')) {
                        const store = db.createObjectStore('feeds', { keyPath: 'id', autoIncrement: true });
                        store.createIndex('name', 'name', { unique: false });
                        store.createIndex('category', 'category', { unique: false });
                    }
                    
                    if (!db.objectStoreNames.contains('articles')) {
                        const articleStore = db.createObjectStore('articles', { keyPath: 'id', autoIncrement: true });
                        articleStore.createIndex('feedId', 'feedId', { unique: false });
                        articleStore.createIndex('pubDate', 'pubDate', { unique: false });
                    }
                };
            });
        }
        
        // „Éï„Ç£„Éº„ÉâÂèñÂæó
        async function getFeeds() {
            if (!db) {
                const stored = localStorage.getItem('rss-feeds');
                return stored ? JSON.parse(stored) : [];
            }
            
            const transaction = db.transaction(['feeds'], 'readonly');
            const store = transaction.objectStore('feeds');
            
            return new Promise((resolve) => {
                const request = store.getAll();
                request.onsuccess = () => resolve(request.result || []);
                request.onerror = () => resolve([]);
            });
        }
        
        // ÂàùÊúüÂåñ
        async function init() {
            await initDB();
            const feeds = await getFeeds();
            
            console.log('ÂèñÂæó„Åó„Åü„Éï„Ç£„Éº„ÉâÊï∞:', feeds.length);
            
            const feedSelector = document.getElementById('feedSelector');
            
            if (feeds.length === 0) {
                // „Éï„Ç£„Éº„Éâ„Åå„Å™„ÅÑÂ†¥Âêà„ÅØ„É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Åã„ÇâÂèñÂæó„ÇíË©¶„Åø„Çã
                const storedFeeds = localStorage.getItem('rss-feeds');
                if (storedFeeds) {
                    const parsedFeeds = JSON.parse(storedFeeds);
                    parsedFeeds.forEach(feed => {
                        const option = document.createElement('option');
                        option.value = JSON.stringify(feed);
                        option.textContent = `${feed.name} (${feed.category || '„Åù„ÅÆ‰ªñ'})`;
                        feedSelector.appendChild(option);
                    });
                    console.log('LocalStorage„Åã„Çâ', parsedFeeds.length, '‰ª∂„ÅÆ„Éï„Ç£„Éº„Éâ„Çí„É≠„Éº„Éâ');
                } else {
                    console.log('„Éï„Ç£„Éº„Éâ„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                    // „Éá„Éï„Ç©„É´„Éà„ÅÆAI„Éï„Ç£„Éº„Éâ„ÇíËøΩÂä†
                    const defaultFeeds = [
                        {id: 1, name: "OpenAI Blog", url: "https://openai.com/news/rss.xml", category: "AIÁ†îÁ©∂Ê©üÈñ¢"},
                        {id: 2, name: "Google AI Blog", url: "https://blog.google/technology/ai/rss/", category: "AIÁ†îÁ©∂Ê©üÈñ¢"},
                        {id: 3, name: "DeepMind Blog", url: "https://deepmind.google/blog/rss.xml", category: "AIÁ†îÁ©∂Ê©üÈñ¢"}
                    ];
                    defaultFeeds.forEach(feed => {
                        const option = document.createElement('option');
                        option.value = JSON.stringify(feed);
                        option.textContent = `${feed.name} (${feed.category})`;
                        feedSelector.appendChild(option);
                    });
                    console.log('„Éá„Éï„Ç©„É´„Éà„Éï„Ç£„Éº„Éâ„ÇíËøΩÂä†');
                }
            } else {
                feeds.forEach(feed => {
                    const option = document.createElement('option');
                    option.value = JSON.stringify(feed);
                    option.textContent = `${feed.name} (${feed.category || '„Åù„ÅÆ‰ªñ'})`;
                    feedSelector.appendChild(option);
                });
                console.log('IndexedDB„Åã„Çâ', feeds.length, '‰ª∂„ÅÆ„Éï„Ç£„Éº„Éâ„Çí„É≠„Éº„Éâ');
            }
        }
        
        // CORSÂõûÈÅø„Çπ„ÉÜ„Éº„Çø„Çπ„ÉÅ„Çß„ÉÉ„ÇØ
        async function checkCORSStatus() {
            const corsStatusElement = document.getElementById('corsStatusText');
            const corsStatusContainer = document.getElementById('corsStatus');
            
            try {
                // Cloudflare Worker„ÅÆÂãï‰ΩúÁ¢∫Ë™ç
                const testUrl = 'https://polished-snow-477a.yutapii.workers.dev?url=https://example.com/';
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 3000);
                
                const response = await fetch(testUrl, {
                    signal: controller.signal,
                    mode: 'cors',
                    credentials: 'omit'
                });
                
                clearTimeout(timeoutId);
                
                if (response.ok) {
                    corsStatusElement.textContent = 'ON';
                    corsStatusContainer.style.background = 'rgba(76, 175, 80, 0.9)';
                    corsStatusContainer.title = 'Cloudflare WorkerÁµåÁî±„ÅßCORSÂõûÈÅø„ÅåÊúâÂäπ„Åß„Åô';
                } else {
                    corsStatusElement.textContent = '„Ç®„É©„Éº';
                    corsStatusContainer.style.background = 'rgba(244, 67, 54, 0.9)';
                    corsStatusContainer.title = 'CORSÂõûÈÅø„Çµ„Éº„Éì„Çπ„Å´Êé•Á∂ö„Åß„Åç„Åæ„Åõ„Çì';
                }
            } catch (error) {
                corsStatusElement.textContent = 'OFF';
                corsStatusContainer.style.background = 'rgba(255, 152, 0, 0.9)';
                corsStatusContainer.title = 'CORSÂõûÈÅø„Çµ„Éº„Éì„Çπ„Åå„Ç™„Éï„É©„Ç§„É≥„Åß„Åô';
            }
        }
        
        init();
        checkCORSStatus();
        
        // ÂÆöÊúüÁöÑ„Å´CORSÁä∂ÊÖã„ÇíÁ¢∫Ë™çÔºà30Áßí„Åî„Å®Ôºâ
        setInterval(checkCORSStatus, 30000);
    </script>
</body>
</html>