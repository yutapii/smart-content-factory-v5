<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é…ä¿¡RSS - è¨˜äº‹è¡¨ç¤º | æ—¥åˆŠAIã‚†ãŸã•ã‚“æ–°è</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans JP', sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 1.8em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .back-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 8px;
            transition: background 0.3s;
        }

        .back-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .control-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .feed-selector {
            flex: 1;
            min-width: 200px;
        }

        .feed-selector select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
            font-size: 14px;
        }

        .search-box {
            flex: 1;
            min-width: 200px;
        }

        .search-box input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        /* æ—¥åˆŠAIã‚†ãŸã•ã‚“æ–°è 4åˆ†é‡ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ */
        .main-categories {
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .category-header {
            font-size: 14px;
            color: #666;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .category-filter {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .category-btn {
            padding: 10px 20px;
            border: 2px solid #ddd;
            background: white;
            color: #666;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .category-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .category-btn.active {
            color: white;
            font-weight: 600;
        }

        .category-btn.active[data-category="all"] {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-color: #667eea;
        }

        .category-btn.active[data-category="ai"] {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-color: #667eea;
        }

        .category-btn.active[data-category="robot"] {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            border-color: #f093fb;
        }

        .category-btn.active[data-category="auto"] {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            border-color: #4facfe;
        }

        .category-btn.active[data-category="telecom"] {
            background: linear-gradient(135deg, #43e97b, #38f9d7);
            border-color: #43e97b;
        }

        .category-btn.active[data-category="other"] {
            background: linear-gradient(135deg, #a8a8a8, #636363);
            border-color: #a8a8a8;
        }

        .category-count {
            background: rgba(255,255,255,0.2);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .category-btn:not(.active) .category-count {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        /* è¨˜äº‹ã‚«ãƒ†ã‚´ãƒªãƒãƒƒã‚¸ */
        .article-category-badge {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-block;
            margin-left: 10px;
        }

        .badge-ai {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .badge-robot {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
        }

        .badge-auto {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: white;
        }

        .badge-telecom {
            background: linear-gradient(135deg, #43e97b, #38f9d7);
            color: white;
        }

        .badge-other {
            background: #e0e0e0;
            color: #666;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .articles-container {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .article-item {
            padding: 20px;
            border-bottom: 1px solid #eee;
            transition: background 0.3s;
            cursor: pointer;
        }

        .article-item:hover {
            background: #f8f9fa;
        }

        .article-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .article-select {
            margin-right: 15px;
        }

        .article-title {
            flex: 1;
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
            text-decoration: none;
            line-height: 1.4;
        }

        .article-title:hover {
            color: #667eea;
        }

        .article-description {
            color: #666;
            font-size: 0.9em;
            line-height: 1.5;
            margin: 10px 0;
        }

        .article-meta {
            display: flex;
            gap: 15px;
            font-size: 0.85em;
            color: #999;
            align-items: center;
        }

        .article-source {
            background: #f0f0f0;
            padding: 2px 8px;
            border-radius: 3px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .empty-state-text {
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .stats-bar {
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-around;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            font-size: 0.85em;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1>ğŸ“¡ é…ä¿¡RSS - æ—¥åˆŠAIã‚†ãŸã•ã‚“æ–°è</h1>
            <div style="display: flex; align-items: center; gap: 15px;">
                <span id="corsStatus" style="font-size: 0.85em; background: rgba(76, 175, 80, 0.9); color: white; padding: 6px 12px; border-radius: 15px; display: flex; align-items: center; gap: 5px;">
                    ğŸŒ CORSå›é¿: <span id="corsStatusText">ç¢ºèªä¸­...</span>
                </span>
                <a href="../index.html" class="back-btn">â† ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸</a>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- çµ±è¨ˆãƒãƒ¼ -->
        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-value" id="totalArticles">0</div>
                <div class="stat-label">å…¨è¨˜äº‹æ•°</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="aiArticles">0</div>
                <div class="stat-label">AIé–¢é€£</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="robotArticles">0</div>
                <div class="stat-label">ãƒ­ãƒœãƒƒãƒˆ</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="autoArticles">0</div>
                <div class="stat-label">è‡ªå‹•é‹è»¢</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="telecomArticles">0</div>
                <div class="stat-label">é€šä¿¡</div>
            </div>
        </div>

        <!-- ãƒ¡ã‚¤ãƒ³4åˆ†é‡ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
        <div class="main-categories">
            <div class="category-header">ğŸ“° æ—¥åˆŠAIã‚†ãŸã•ã‚“æ–°è - ãƒ¡ã‚¤ãƒ³ã‚«ãƒ†ã‚´ãƒªã§çµã‚Šè¾¼ã¿</div>
            <div class="category-filter" id="categoryFilter">
                <button class="category-btn active" data-category="all" onclick="filterByMainCategory('all')">
                    <span>ğŸŒ å…¨ã¦è¡¨ç¤º</span>
                    <span class="category-count" id="count-all">0</span>
                </button>
                <button class="category-btn" data-category="ai" onclick="filterByMainCategory('ai')">
                    <span>ğŸ¤– AI</span>
                    <span class="category-count" id="count-ai">0</span>
                </button>
                <button class="category-btn" data-category="robot" onclick="filterByMainCategory('robot')">
                    <span>ğŸ¦¾ ãƒ­ãƒœãƒƒãƒˆ</span>
                    <span class="category-count" id="count-robot">0</span>
                </button>
                <button class="category-btn" data-category="auto" onclick="filterByMainCategory('auto')">
                    <span>ğŸš— è‡ªå‹•é‹è»¢</span>
                    <span class="category-count" id="count-auto">0</span>
                </button>
                <button class="category-btn" data-category="telecom" onclick="filterByMainCategory('telecom')">
                    <span>ğŸ“¡ é€šä¿¡</span>
                    <span class="category-count" id="count-telecom">0</span>
                </button>
                <button class="category-btn" data-category="other" onclick="filterByMainCategory('other')">
                    <span>ğŸ“° ãã®ä»–</span>
                    <span class="category-count" id="count-other">0</span>
                </button>
            </div>
        </div>

        <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
        <div class="controls">
            <div class="control-row">
                <div class="feed-selector">
                    <select id="feedSelector">
                        <option value="all">å…¨ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ‰</option>
                    </select>
                </div>
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="è¨˜äº‹ã‚’ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢...">
                </div>
                <button class="btn btn-primary" onclick="fetchArticles()">ğŸ”„ æ›´æ–°</button>
                <button class="btn btn-secondary" onclick="saveSelectedArticles()">ğŸ’¾ é¸æŠã‚’ä¿å­˜</button>
            </div>
        </div>

        <!-- è¨˜äº‹ä¸€è¦§ -->
        <div class="articles-container" id="articlesContainer">
            <div class="empty-state">
                <div class="empty-state-icon">ğŸ“¡</div>
                <div class="empty-state-text">è¨˜äº‹ã‚’å–å¾—ã™ã‚‹ã«ã¯</div>
                <div class="empty-state-text">ãƒ•ã‚£ãƒ¼ãƒ‰ã‚’é¸æŠã—ã¦æ›´æ–°ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„</div>
            </div>
        </div>
    </div>

    <!-- å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ -->
    <script src="../js/utils.js"></script>
    <script>
        let allArticles = [];
        let displayedArticles = [];
        let savedArticles = [];
        let currentCategoryFilter = 'all';
        let db = null;
        
        // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆæ—¥åˆŠAIã‚†ãŸã•ã‚“æ–°èã®4åˆ†é‡ï¼‰
        const categoryKeywords = {
            ai: [
                'AI', 'äººå·¥çŸ¥èƒ½', 'ChatGPT', 'GPT', 'Claude', 'Gemini', 'Copilot', 'LLM', 'æ©Ÿæ¢°å­¦ç¿’',
                'ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°', 'æ·±å±¤å­¦ç¿’', 'ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆ', 'OpenAI', 'Anthropic', 'Google AI',
                'ç”ŸæˆAI', 'ç”»åƒAI', 'éŸ³å£°AI', 'Stable Diffusion', 'Midjourney', 'DALL-E',
                'ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹', 'ãƒ“ãƒƒã‚°ãƒ‡ãƒ¼ã‚¿', 'è‡ªç„¶è¨€èªå‡¦ç†', 'NLP', 'AGI', 'æ±ç”¨äººå·¥çŸ¥èƒ½',
                'ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ', 'ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°', 'ãƒˆãƒ©ãƒ³ã‚¹ãƒ•ã‚©ãƒ¼ãƒãƒ¼', 'Transformer',
                'Hugging Face', 'LangChain', 'Vector', 'Embedding', 'RAG'
            ],
            robot: [
                'ãƒ­ãƒœãƒƒãƒˆ', 'ãƒ­ãƒœ', 'ãƒ‰ãƒ­ãƒ¼ãƒ³', 'ã‚¢ãƒ³ãƒ‰ãƒ­ã‚¤ãƒ‰', 'ã‚µã‚¤ãƒœãƒ¼ã‚°', 'ãƒœãƒƒãƒˆ',
                'ãƒ’ãƒ¥ãƒ¼ãƒãƒã‚¤ãƒ‰', 'ç”£æ¥­ãƒ­ãƒœãƒƒãƒˆ', 'ã‚µãƒ¼ãƒ“ã‚¹ãƒ­ãƒœãƒƒãƒˆ', 'ä»‹è­·ãƒ­ãƒœãƒƒãƒˆ',
                'ã‚¢ã‚·ã‚¹ãƒˆã‚¹ãƒ¼ãƒ„', 'ã‚³ãƒœãƒƒãƒˆ', 'Boston Dynamics', 'Spot', 'Atlas',
                'ãƒ­ãƒœãƒ†ã‚£ã‚¯ã‚¹', 'ROS', 'ãƒ¡ã‚«ãƒˆãƒ­ãƒ‹ã‚¯ã‚¹', 'ã‚ªãƒ¼ãƒˆãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³', 'è‡ªå‹•åŒ–',
                'ãƒ‘ãƒ¯ãƒ¼ãƒ‰ã‚¹ãƒ¼ãƒ„', 'ã‚¨ã‚¯ã‚½ã‚¹ã‚±ãƒ«ãƒˆãƒ³', 'ã‚½ãƒ•ãƒˆãƒ­ãƒœãƒƒãƒˆ', 'å”åƒãƒ­ãƒœãƒƒãƒˆ',
                'AMR', 'AGV', 'ãƒ¢ãƒ“ãƒªãƒ†ã‚£ãƒ­ãƒœãƒƒãƒˆ'
            ],
            auto: [
                'è‡ªå‹•é‹è»¢', 'è‡ªå¾‹èµ°è¡Œ', 'Tesla', 'ãƒ†ã‚¹ãƒ©', 'Waymo', 'Cruise', 'Robotaxi',
                'ADAS', 'ãƒ¬ãƒ™ãƒ«2', 'ãƒ¬ãƒ™ãƒ«3', 'ãƒ¬ãƒ™ãƒ«4', 'ãƒ¬ãƒ™ãƒ«5', 'LiDAR', 'ãƒ©ã‚¤ãƒ€ãƒ¼',
                'EV', 'é›»æ°—è‡ªå‹•è»Š', 'BEV', 'FSD', 'Autopilot', 'MaaS', 'CASE',
                'ã‚³ãƒã‚¯ãƒ†ãƒƒãƒ‰ã‚«ãƒ¼', 'è»Šè¼‰AI', 'V2X', 'é«˜åº¦é‹è»¢æ”¯æ´', 'ã‚»ãƒ³ã‚µãƒ¼ãƒ•ãƒ¥ãƒ¼ã‚¸ãƒ§ãƒ³',
                'ãƒŸãƒªæ³¢ãƒ¬ãƒ¼ãƒ€ãƒ¼', 'ã‚«ãƒ¡ãƒ©ã‚»ãƒ³ã‚µãƒ¼', 'è‡ªå‹•é§è»Š', 'OTA', 'ADAS',
                'ãƒ¢ãƒ“ãƒªãƒ†ã‚£', 'ã‚¹ãƒãƒ¼ãƒˆã‚«ãƒ¼', 'å®Œå…¨è‡ªå‹•é‹è»¢'
            ],
            telecom: [
                '5G', '6G', 'é€šä¿¡', 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯', 'IoT', 'ã‚¨ãƒƒã‚¸ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°',
                'ã‚¯ãƒ©ã‚¦ãƒ‰', 'AWS', 'Azure', 'GCP', 'ã‚µãƒ¼ãƒãƒ¼', 'ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼',
                'Wi-Fi', 'Bluetooth', 'NFC', 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£', 'ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£',
                'ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³', 'é‡å­é€šä¿¡', 'è¡›æ˜Ÿé€šä¿¡', 'Starlink', 'ã‚¹ã‚¿ãƒ¼ãƒªãƒ³ã‚¯',
                'API', 'ã‚¤ãƒ³ãƒ•ãƒ©', 'CDN', 'VPN', 'æš—å·åŒ–', 'ã‚¼ãƒ­ãƒˆãƒ©ã‚¹ãƒˆ',
                'SD-WAN', 'NFV', 'ãƒ­ãƒ¼ã‚«ãƒ«5G', 'Beyond 5G', 'Open RAN',
                'å…‰ãƒ•ã‚¡ã‚¤ãƒãƒ¼', 'FTTH', 'ãƒ¡ã‚¿ãƒãƒ¼ã‚¹é€šä¿¡', 'XRé€šä¿¡'
            ]
        };
        
        // è¨˜äº‹ã‚’ã‚«ãƒ†ã‚´ãƒªåˆ†é¡
        function categorizeArticle(article) {
            const text = (article.title + ' ' + (article.description || '')).toLowerCase();
            
            // å„ã‚«ãƒ†ã‚´ãƒªã®ã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—
            const scores = {
                ai: 0,
                robot: 0,
                auto: 0,
                telecom: 0
            };
            
            for (const [category, keywords] of Object.entries(categoryKeywords)) {
                for (const keyword of keywords) {
                    if (text.includes(keyword.toLowerCase())) {
                        scores[category] += keyword.length > 5 ? 2 : 1; // é•·ã„ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯é‡ã¿ä»˜ã‘
                    }
                }
            }
            
            // æœ€é«˜ã‚¹ã‚³ã‚¢ã®ã‚«ãƒ†ã‚´ãƒªã‚’è¿”ã™
            let maxScore = 0;
            let assignedCategory = 'other';
            
            for (const [category, score] of Object.entries(scores)) {
                if (score > maxScore) {
                    maxScore = score;
                    assignedCategory = category;
                }
            }
            
            return maxScore > 0 ? assignedCategory : 'other';
        }
        
        // ãƒ¡ã‚¤ãƒ³ã‚«ãƒ†ã‚´ãƒªã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
        function filterByMainCategory(category) {
            currentCategoryFilter = category;
            
            // ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.category === category) {
                    btn.classList.add('active');
                }
            });
            
            // è¨˜äº‹ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ã¦è¡¨ç¤º
            applyFilters();
        }
        
        // ã‚«ãƒ†ã‚´ãƒªã‚«ã‚¦ãƒ³ãƒˆã‚’æ›´æ–°
        function updateCategoryCounts(articles = allArticles) {
            const counts = {
                all: articles.length,
                ai: 0,
                robot: 0,
                auto: 0,
                telecom: 0,
                other: 0
            };
            
            articles.forEach(article => {
                if (!article.category) {
                    article.category = categorizeArticle(article);
                }
                counts[article.category]++;
            });
            
            // ã‚«ã‚¦ãƒ³ãƒˆã‚’è¡¨ç¤º
            for (const [category, count] of Object.entries(counts)) {
                const element = document.getElementById(`count-${category}`);
                if (element) {
                    element.textContent = count;
                }
            }
            
            // çµ±è¨ˆãƒãƒ¼ã‚‚æ›´æ–°
            // Utils.updateElementsã§ä¸€æ‹¬æ›´æ–°ï¼ˆé«˜é€ŸåŒ–ï¼‰
            Utils.updateElements([
                { element: document.getElementById('totalArticles'), property: 'text', value: counts.all },
                { element: document.getElementById('aiArticles'), property: 'text', value: counts.ai },
                { element: document.getElementById('robotArticles'), property: 'text', value: counts.robot },
                { element: document.getElementById('autoArticles'), property: 'text', value: counts.auto },
                { element: document.getElementById('telecomArticles'), property: 'text', value: counts.telecom }
            ]);
        }
        
        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’é©ç”¨
        function applyFilters() {
            let filtered = [...allArticles];
            
            // ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
            if (currentCategoryFilter !== 'all') {
                filtered = filtered.filter(article => {
                    if (!article.category) {
                        article.category = categorizeArticle(article);
                    }
                    return article.category === currentCategoryFilter;
                });
            }
            
            // æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (searchTerm) {
                filtered = filtered.filter(article => {
                    return article.title.toLowerCase().includes(searchTerm) ||
                           (article.description && article.description.toLowerCase().includes(searchTerm)) ||
                           (article.source && article.source.toLowerCase().includes(searchTerm));
                });
            }
            
            displayedArticles = filtered;
            displayArticles(filtered);
        }
        
        // è¨˜äº‹è¡¨ç¤º
        function displayArticles(articles) {
            const container = document.getElementById('articlesContainer');
            
            // ã‚«ãƒ†ã‚´ãƒªã‚«ã‚¦ãƒ³ãƒˆã‚’æ›´æ–°
            updateCategoryCounts(allArticles);
            
            if (articles.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“¡</div>
                        <div class="empty-state-text">è¨˜äº‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div>
                        <div class="empty-state-text">åˆ¥ã®ã‚«ãƒ†ã‚´ãƒªã‚„æ¤œç´¢æ¡ä»¶ã‚’è©¦ã—ã¦ãã ã•ã„</div>
                    </div>
                `;
                return;
            }
            
            // ã‚«ãƒ†ã‚´ãƒªã‚’å‰²ã‚Šå½“ã¦
            articles.forEach(article => {
                if (!article.category) {
                    article.category = categorizeArticle(article);
                }
            });
            
            const categoryBadgeClass = {
                ai: 'badge-ai',
                robot: 'badge-robot',
                auto: 'badge-auto',
                telecom: 'badge-telecom',
                other: 'badge-other'
            };
            
            const categoryNames = {
                ai: 'AI',
                robot: 'ãƒ­ãƒœãƒƒãƒˆ',
                auto: 'è‡ªå‹•é‹è»¢',
                telecom: 'é€šä¿¡',
                other: 'ãã®ä»–'
            };
            
            container.innerHTML = articles.map((article, index) => `
                <div class="article-item">
                    <div class="article-header">
                        <input type="checkbox" class="article-select" data-index="${index}">
                        <a href="${article.link}" target="_blank" class="article-title">
                            ${article.title}
                        </a>
                    </div>
                    <div class="article-description">${article.description || ''}</div>
                    <div class="article-meta">
                        <span class="article-source">${article.source || 'ä¸æ˜'}</span>
                        <span class="article-date">${article.pubDate ? new Date(article.pubDate).toLocaleString('ja-JP') : ''}</span>
                        <span class="article-category-badge ${categoryBadgeClass[article.category]}">
                            ${categoryNames[article.category]}
                        </span>
                    </div>
                </div>
            `).join('');
        }
        
        // è¨˜äº‹å–å¾—
        async function fetchArticles() {
            const feedSelector = document.getElementById('feedSelector');
            const selectedFeed = feedSelector.value;
            
            const workerUrl = 'https://polished-snow-477a.yutapii.workers.dev';
            let feedsToFetch = [];
            
            if (selectedFeed === 'all') {
                // å…¨ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ‰ã‚’å–å¾—
                const options = feedSelector.options;
                for (let i = 1; i < options.length; i++) { // index 0ã¯ã€Œå…¨ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ‰ã€ãªã®ã§ã‚¹ã‚­ãƒƒãƒ—
                    try {
                        const feed = JSON.parse(options[i].value);
                        feedsToFetch.push(feed);
                    } catch (e) {
                        console.error('ãƒ•ã‚£ãƒ¼ãƒ‰ã®ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼:', e);
                    }
                }
                
                if (feedsToFetch.length === 0) {
                    alert('å–å¾—å¯èƒ½ãªãƒ•ã‚£ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤º
                const container = document.getElementById('articlesContainer');
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">â³</div>
                        <div class="empty-state-text">å…¨ãƒ•ã‚£ãƒ¼ãƒ‰ã‹ã‚‰è¨˜äº‹ã‚’å–å¾—ä¸­...</div>
                        <div class="empty-state-text">0 / ${feedsToFetch.length} å®Œäº†</div>
                    </div>
                `;
            } else {
                feedsToFetch = [JSON.parse(selectedFeed)];
            }
            
            allArticles = [];
            let successCount = 0;
            let errorCount = 0;
            
            // å„ãƒ•ã‚£ãƒ¼ãƒ‰ã‹ã‚‰è¨˜äº‹ã‚’å–å¾—
            for (let i = 0; i < feedsToFetch.length; i++) {
                const feed = feedsToFetch[i];
                
                // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æ›´æ–°ï¼ˆå…¨ãƒ•ã‚£ãƒ¼ãƒ‰ã®å ´åˆï¼‰
                if (selectedFeed === 'all') {
                    const container = document.getElementById('articlesContainer');
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">â³</div>
                            <div class="empty-state-text">å…¨ãƒ•ã‚£ãƒ¼ãƒ‰ã‹ã‚‰è¨˜äº‹ã‚’å–å¾—ä¸­...</div>
                            <div class="empty-state-text">${i + 1} / ${feedsToFetch.length} å‡¦ç†ä¸­</div>
                            <div class="empty-state-text" style="font-size: 0.9em; margin-top: 10px;">
                                ç¾åœ¨: ${feed.name}<br>
                                æˆåŠŸ: ${successCount} / ã‚¨ãƒ©ãƒ¼: ${errorCount}
                            </div>
                        </div>
                    `;
                }
                
                try {
                    const response = await fetch(`${workerUrl}?url=${encodeURIComponent(feed.url)}`);
                    const text = await response.text();
                    
                    const parser = new DOMParser();
                    const xml = parser.parseFromString(text, 'text/xml');
                    
                    const items = xml.querySelectorAll('item, entry');
                    const articles = Array.from(items).map(item => {
                        const getElementText = (tagName) => {
                            const elem = item.querySelector(tagName);
                            return elem ? elem.textContent : '';
                        };
                        
                        return {
                            title: getElementText('title'),
                            link: getElementText('link') || getElementText('id'),
                            description: getElementText('description') || getElementText('summary') || getElementText('content'),
                            pubDate: getElementText('pubDate') || getElementText('published') || getElementText('updated'),
                            source: feed.name,
                            feedId: feed.id
                        };
                    });
                    
                    allArticles.push(...articles);
                    successCount++;
                    
                } catch (error) {
                    console.error(`${feed.name}ã®å–å¾—ã‚¨ãƒ©ãƒ¼:`, error);
                    errorCount++;
                }
                
                // ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’é¿ã‘ã‚‹ãŸã‚å°‘ã—å¾…æ©Ÿï¼ˆå…¨ãƒ•ã‚£ãƒ¼ãƒ‰ã®å ´åˆï¼‰
                if (selectedFeed === 'all' && i < feedsToFetch.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
            }
            
            // å…¨è¨˜äº‹ã«ã‚«ãƒ†ã‚´ãƒªã‚’å‰²ã‚Šå½“ã¦
            allArticles.forEach(article => {
                article.category = categorizeArticle(article);
            });
            
            // æ—¥ä»˜ã§ã‚½ãƒ¼ãƒˆï¼ˆæ–°ã—ã„é †ï¼‰
            allArticles.sort((a, b) => {
                const dateA = new Date(a.pubDate || 0);
                const dateB = new Date(b.pubDate || 0);
                return dateB - dateA;
            });
            
            // å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆå…¨ãƒ•ã‚£ãƒ¼ãƒ‰ã®å ´åˆï¼‰
            if (selectedFeed === 'all') {
                console.log(`å–å¾—å®Œäº†: ${allArticles.length}ä»¶ã®è¨˜äº‹ (æˆåŠŸ: ${successCount}, ã‚¨ãƒ©ãƒ¼: ${errorCount})`);
            }
            
            applyFilters();
        }
        
        // é¸æŠè¨˜äº‹ã‚’ä¿å­˜
        function saveSelectedArticles() {
            const checkboxes = document.querySelectorAll('.article-select:checked');
            const selected = Array.from(checkboxes).map(cb => displayedArticles[cb.dataset.index]);
            
            if (selected.length === 0) {
                alert('ä¿å­˜ã™ã‚‹è¨˜äº‹ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            const saved = JSON.parse(localStorage.getItem('saved-articles') || '[]');
            saved.push(...selected);
            localStorage.setItem('saved-articles', JSON.stringify(saved));
            
            alert(`${selected.length}ä»¶ã®è¨˜äº‹ã‚’ä¿å­˜ã—ã¾ã—ãŸ`);
        }
        
        // æ¤œç´¢æ©Ÿèƒ½
        document.getElementById('searchInput').addEventListener('input', () => {
            applyFilters();
        });
        
        // IndexedDBåˆæœŸåŒ–
        async function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('SCFV5_RSS', 2);
                
                request.onerror = () => {
                    console.error('DBæ¥ç¶šã‚¨ãƒ©ãƒ¼');
                    resolve(null);
                };
                
                request.onsuccess = () => {
                    db = request.result;
                    resolve(db);
                };
                
                request.onupgradeneeded = (event) => {
                    db = event.target.result;
                    
                    if (!db.objectStoreNames.contains('feeds')) {
                        const store = db.createObjectStore('feeds', { keyPath: 'id', autoIncrement: true });
                        store.createIndex('name', 'name', { unique: false });
                        store.createIndex('category', 'category', { unique: false });
                    }
                    
                    if (!db.objectStoreNames.contains('articles')) {
                        const articleStore = db.createObjectStore('articles', { keyPath: 'id', autoIncrement: true });
                        articleStore.createIndex('feedId', 'feedId', { unique: false });
                        articleStore.createIndex('pubDate', 'pubDate', { unique: false });
                    }
                };
            });
        }
        
        // ãƒ•ã‚£ãƒ¼ãƒ‰å–å¾—
        async function getFeeds() {
            if (!db) {
                const stored = localStorage.getItem('rss-feeds');
                return stored ? JSON.parse(stored) : [];
            }
            
            const transaction = db.transaction(['feeds'], 'readonly');
            const store = transaction.objectStore('feeds');
            
            return new Promise((resolve) => {
                const request = store.getAll();
                request.onsuccess = () => resolve(request.result || []);
                request.onerror = () => resolve([]);
            });
        }
        
        // åˆæœŸåŒ–
        async function init() {
            await initDB();
            const feeds = await getFeeds();
            
            console.log('å–å¾—ã—ãŸãƒ•ã‚£ãƒ¼ãƒ‰æ•°:', feeds.length);
            
            const feedSelector = document.getElementById('feedSelector');
            
            if (feeds.length === 0) {
                // ãƒ•ã‚£ãƒ¼ãƒ‰ãŒãªã„å ´åˆã¯ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰å–å¾—ã‚’è©¦ã¿ã‚‹
                const storedFeeds = localStorage.getItem('rss-feeds');
                if (storedFeeds) {
                    const parsedFeeds = JSON.parse(storedFeeds);
                    parsedFeeds.forEach(feed => {
                        const option = document.createElement('option');
                        option.value = JSON.stringify(feed);
                        option.textContent = `${feed.name} (${feed.category || 'ãã®ä»–'})`;
                        feedSelector.appendChild(option);
                    });
                    console.log('LocalStorageã‹ã‚‰', parsedFeeds.length, 'ä»¶ã®ãƒ•ã‚£ãƒ¼ãƒ‰ã‚’ãƒ­ãƒ¼ãƒ‰');
                } else {
                    console.log('ãƒ•ã‚£ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®AIãƒ•ã‚£ãƒ¼ãƒ‰ã‚’è¿½åŠ 
                    const defaultFeeds = [
                        {id: 1, name: "OpenAI Blog", url: "https://openai.com/news/rss.xml", category: "AIç ”ç©¶æ©Ÿé–¢"},
                        {id: 2, name: "Google AI Blog", url: "https://blog.google/technology/ai/rss/", category: "AIç ”ç©¶æ©Ÿé–¢"},
                        {id: 3, name: "DeepMind Blog", url: "https://deepmind.google/blog/rss.xml", category: "AIç ”ç©¶æ©Ÿé–¢"}
                    ];
                    defaultFeeds.forEach(feed => {
                        const option = document.createElement('option');
                        option.value = JSON.stringify(feed);
                        option.textContent = `${feed.name} (${feed.category})`;
                        feedSelector.appendChild(option);
                    });
                    console.log('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ•ã‚£ãƒ¼ãƒ‰ã‚’è¿½åŠ ');
                }
            } else {
                feeds.forEach(feed => {
                    const option = document.createElement('option');
                    option.value = JSON.stringify(feed);
                    option.textContent = `${feed.name} (${feed.category || 'ãã®ä»–'})`;
                    feedSelector.appendChild(option);
                });
                console.log('IndexedDBã‹ã‚‰', feeds.length, 'ä»¶ã®ãƒ•ã‚£ãƒ¼ãƒ‰ã‚’ãƒ­ãƒ¼ãƒ‰');
            }
        }
        
        // CORSå›é¿ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒã‚§ãƒƒã‚¯
        async function checkCORSStatus() {
            const corsStatusElement = document.getElementById('corsStatusText');
            const corsStatusContainer = document.getElementById('corsStatus');
            
            try {
                // Cloudflare Workerã®å‹•ä½œç¢ºèª
                const testUrl = 'https://polished-snow-477a.yutapii.workers.dev?url=https://example.com/';
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 3000);
                
                const response = await fetch(testUrl, {
                    signal: controller.signal,
                    mode: 'cors',
                    credentials: 'omit'
                });
                
                clearTimeout(timeoutId);
                
                if (response.ok) {
                    corsStatusElement.textContent = 'ON';
                    corsStatusContainer.style.background = 'rgba(76, 175, 80, 0.9)';
                    corsStatusContainer.title = 'Cloudflare WorkerçµŒç”±ã§CORSå›é¿ãŒæœ‰åŠ¹ã§ã™';
                } else {
                    corsStatusElement.textContent = 'ã‚¨ãƒ©ãƒ¼';
                    corsStatusContainer.style.background = 'rgba(244, 67, 54, 0.9)';
                    corsStatusContainer.title = 'CORSå›é¿ã‚µãƒ¼ãƒ“ã‚¹ã«æ¥ç¶šã§ãã¾ã›ã‚“';
                }
            } catch (error) {
                corsStatusElement.textContent = 'OFF';
                corsStatusContainer.style.background = 'rgba(255, 152, 0, 0.9)';
                corsStatusContainer.title = 'CORSå›é¿ã‚µãƒ¼ãƒ“ã‚¹ãŒã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã™';
            }
        }
        
        init();
        checkCORSStatus();
        
        // å®šæœŸçš„ã«CORSçŠ¶æ…‹ã‚’ç¢ºèªï¼ˆ30ç§’ã”ã¨ï¼‰
        setInterval(checkCORSStatus, 30000);
    </script>
</body>
</html>