<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>06 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
        }
        .article {
            border: 1px solid #ddd;
            padding: 10px;
            margin: 10px 0;
            position: relative;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .article:hover {
            background-color: #f5f5f5;
        }
        .article.selected {
            background-color: #e3f2fd;
            border-color: #1976d2;
        }
        .checkbox-wrapper {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
        }
        .article-content {
            margin-left: 40px;
        }
        .title {
            font-weight: bold;
            color: #333;
        }
        .meta {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            font-size: 16px;
            cursor: pointer;
        }
        .selection-bar {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            border: 2px solid #1976d2;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            display: none;
            z-index: 1000;
        }
        .selection-bar.active {
            display: block;
        }
        .selection-count {
            font-weight: bold;
            color: #1976d2;
            margin-bottom: 10px;
        }
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        .btn-send {
            background: linear-gradient(135deg, #4caf50, #8bc34a);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        .btn-clear {
            background: #f44336;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div style="margin-bottom: 20px; display: flex; gap: 10px;">
        <a href="../index.html" style="text-decoration: none; background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 10px 20px; border-radius: 8px; display: inline-block; font-weight: bold;">
            â† ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹
        </a>
        <a href="../10_rss-to-article.html" style="text-decoration: none; background: linear-gradient(135deg, #ff6b6b, #feca57); color: white; padding: 10px 20px; border-radius: 8px; display: inline-block; font-weight: bold;">
            â†’ [10] RSSâ†’è¨˜äº‹é€£æºã¸
        </a>
    </div>
    <h1>06 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ - è¨˜äº‹ä¸€è¦§</h1>
    <button onclick="loadFromFile()">ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã¿</button>
    <button onclick="loadFromRSS()">05_RSSã‹ã‚‰èª­ã¿è¾¼ã¿</button>
    <button onclick="filterByCategory('AI')">AIã®ã¿</button>
    <button onclick="filterByCategory('ãƒ­ãƒœãƒƒãƒˆ')">ãƒ­ãƒœãƒƒãƒˆã®ã¿</button>
    <button onclick="filterByCategory('è‡ªå‹•é‹è»¢')">è‡ªå‹•é‹è»¢ã®ã¿</button>
    <button onclick="filterByCategory('é€šä¿¡')">é€šä¿¡ã®ã¿</button>
    <button onclick="showAll()">å…¨ã¦è¡¨ç¤º</button>
    <button onclick="clearRSSData()" style="background: #ff5722; color: white;">RSSãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢</button>
    <button onclick="selectAll()" style="background: #2196f3; color: white;">å…¨ã¦é¸æŠ</button>
    <button onclick="deselectAll()" style="background: #9e9e9e; color: white;">é¸æŠè§£é™¤</button>
    <div id="count"></div>
    <div id="articles"></div>
    
    <!-- é¸æŠãƒãƒ¼ -->
    <div class="selection-bar" id="selectionBar">
        <div class="selection-count" id="selectionCount">0ä»¶é¸æŠä¸­</div>
        <div class="action-buttons">
            <button class="btn-send" onclick="sendToModule10()">
                [10]ã¸é€ä¿¡
            </button>
            <button class="btn-clear" onclick="deselectAll()">
                ã‚¯ãƒªã‚¢
            </button>
        </div>
    </div>

    <script>
        let allData = null;
        let selectedArticles = new Set();
        let currentDisplayedArticles = [];
        
        // ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã¿ï¼ˆæ—¢å­˜ã®data.jsonï¼‰
        async function loadFromFile() {
            try {
                const response = await fetch('./data/batch_001.json');
                allData = await response.json();
                displayArticles(allData.articles);
                showMessage('ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ', 'success');
            } catch (error) {
                console.error('ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                showMessage('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }
        
        // 05_rss-readerã‹ã‚‰èª­ã¿è¾¼ã¿ï¼ˆlocalStorageï¼‰
        function loadFromRSS() {
            try {
                const stored = localStorage.getItem('06_database_articles');
                if (stored) {
                    allData = JSON.parse(stored);
                    displayArticles(allData.articles);
                    showMessage(`05_rss-readerã‹ã‚‰${allData.articles.length}ä»¶ã®è¨˜äº‹ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`, 'success');
                } else {
                    showMessage('05_rss-readerã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚å…ˆã«05_rss-readerã§ã€Œ06ã¸ä¿å­˜ã€ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„', 'warning');
                }
            } catch (error) {
                console.error('localStorageèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                showMessage('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }
        
        // RSSãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
        function clearRSSData() {
            if (confirm('05_rss-readerã‹ã‚‰ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) {
                localStorage.removeItem('06_database_articles');
                allData = null;
                document.getElementById('articles').innerHTML = '';
                document.getElementById('count').textContent = '';
                showMessage('RSSãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'success');
            }
        }
        
        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
        function showMessage(message, type) {
            const count = document.getElementById('count');
            const color = type === 'success' ? '#4caf50' : type === 'error' ? '#f44336' : '#ff9800';
            count.innerHTML = `<span style="color: ${color}; font-weight: bold;">${message}</span>`;
            setTimeout(() => {
                if (allData && allData.articles) {
                    count.textContent = `è¡¨ç¤ºä¸­: ${allData.articles.length}ä»¶`;
                }
            }, 3000);
        }
        
        function displayArticles(articles) {
            const container = document.getElementById('articles');
            const count = document.getElementById('count');
            
            count.textContent = `è¡¨ç¤ºä¸­: ${articles.length}ä»¶`;
            currentDisplayedArticles = articles;
            
            // è¨˜äº‹ã‚’æ—¥ä»˜ã®æ–°ã—ã„é †ã«ã‚½ãƒ¼ãƒˆ
            const sortedArticles = [...articles].sort((a, b) => {
                const dateA = new Date(a.date || '2000-01-01');
                const dateB = new Date(b.date || '2000-01-01');
                return dateB - dateA;
            });
            
            container.innerHTML = sortedArticles.map((article, index) => {
                const uniqueId = `article-${article.id || index}`;
                const isSelected = selectedArticles.has(uniqueId);
                return `
                <div class="article ${isSelected ? 'selected' : ''}" data-article-id="${uniqueId}" onclick="toggleSelection('${uniqueId}')">
                    <div class="checkbox-wrapper">
                        <input type="checkbox" ${isSelected ? 'checked' : ''} onclick="event.stopPropagation(); toggleSelection('${uniqueId}')">
                    </div>
                    <div class="article-content">
                        <div class="title">${article.id}. ${article.title}</div>
                        <div>${article.description || ''}</div>
                        <div class="meta">
                            ğŸ“… ${article.date || 'æ—¥ä»˜ä¸æ˜'} | ğŸ“° ${article.source || 'ä¸æ˜'} | ğŸ·ï¸ ${article.category || 'ãã®ä»–'}
                            ${article.url ? `| <a href="${article.url}" target="_blank" style="color: #1976d2;" onclick="event.stopPropagation();">ğŸ”— è¨˜äº‹ã‚’èª­ã‚€</a>` : ''}
                        </div>
                    </div>
                </div>
            `}).join('');
            
            updateSelectionBar();
        }
        
        // è¨˜äº‹ã®é¸æŠã‚’ãƒˆã‚°ãƒ«
        function toggleSelection(articleId) {
            const articleElement = document.querySelector(`[data-article-id="${articleId}"]`);
            const checkbox = articleElement.querySelector('input[type="checkbox"]');
            
            if (selectedArticles.has(articleId)) {
                selectedArticles.delete(articleId);
                articleElement.classList.remove('selected');
                checkbox.checked = false;
            } else {
                selectedArticles.add(articleId);
                articleElement.classList.add('selected');
                checkbox.checked = true;
            }
            
            updateSelectionBar();
        }
        
        // å…¨ã¦é¸æŠ
        function selectAll() {
            const articles = document.querySelectorAll('.article');
            articles.forEach(article => {
                const articleId = article.dataset.articleId;
                selectedArticles.add(articleId);
                article.classList.add('selected');
                const checkbox = article.querySelector('input[type="checkbox"]');
                if (checkbox) checkbox.checked = true;
            });
            updateSelectionBar();
        }
        
        // é¸æŠè§£é™¤
        function deselectAll() {
            selectedArticles.clear();
            const articles = document.querySelectorAll('.article');
            articles.forEach(article => {
                article.classList.remove('selected');
                const checkbox = article.querySelector('input[type="checkbox"]');
                if (checkbox) checkbox.checked = false;
            });
            updateSelectionBar();
        }
        
        // é¸æŠãƒãƒ¼ã®æ›´æ–°
        function updateSelectionBar() {
            const selectionBar = document.getElementById('selectionBar');
            const selectionCount = document.getElementById('selectionCount');
            
            if (selectedArticles.size > 0) {
                selectionBar.classList.add('active');
                selectionCount.textContent = `${selectedArticles.size}ä»¶é¸æŠä¸­`;
            } else {
                selectionBar.classList.remove('active');
            }
        }
        
        // ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«10ã¸é€ä¿¡
        function sendToModule10() {
            if (selectedArticles.size === 0) {
                showMessage('è¨˜äº‹ã‚’é¸æŠã—ã¦ãã ã•ã„', 'warning');
                return;
            }
            
            // é¸æŠã•ã‚ŒãŸè¨˜äº‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            const selectedData = [];
            currentDisplayedArticles.forEach((article, index) => {
                const uniqueId = `article-${article.id || index}`;
                if (selectedArticles.has(uniqueId)) {
                    selectedData.push(article);
                }
            });
            
            // localStorageã«ä¿å­˜
            localStorage.setItem('selected_articles_for_10', JSON.stringify({
                articles: selectedData,
                selectedAt: new Date().toISOString(),
                source: '06_database'
            }));
            
            showMessage(`${selectedData.length}ä»¶ã®è¨˜äº‹ã‚’[10]ã¸é€ä¿¡ã—ã¾ã—ãŸ`, 'success');
            
            // 3ç§’å¾Œã«10ã¸é·ç§»
            setTimeout(() => {
                window.location.href = '../10_rss-to-article.html';
            }, 2000);
        }
        
        function filterByCategory(category) {
            if (!allData) {
                showMessage('å…ˆã«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„', 'warning');
                return;
            }
            const filtered = allData.articles.filter(a => a.category === category);
            displayArticles(filtered);
        }
        
        function showAll() {
            if (!allData) {
                showMessage('å…ˆã«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„', 'warning');
                return;
            }
            displayArticles(allData.articles);
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•ã§RSSãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèª
        window.addEventListener('load', () => {
            const stored = localStorage.getItem('06_database_articles');
            if (stored) {
                try {
                    const data = JSON.parse(stored);
                    const lastUpdated = data.lastUpdated ? new Date(data.lastUpdated).toLocaleString('ja-JP') : 'ä¸æ˜';
                    showMessage(`05_rss-readerã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿ã‚ã‚Šï¼ˆæœ€çµ‚æ›´æ–°: ${lastUpdated}ï¼‰`, 'success');
                } catch (e) {
                    console.error('ãƒ‡ãƒ¼ã‚¿ç¢ºèªã‚¨ãƒ©ãƒ¼:', e);
                }
            }
        });
    </script>
</body>
</html>