<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>06 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ - è¿½è¨˜å‹ç®¡ç†</title>
    <style>
        body {
            font-family: -apple-system, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #2196F3;
        }
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }
        button:hover {
            background: #45a049;
        }
        .article {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .article-id {
            color: #2196F3;
            font-weight: bold;
        }
        #log {
            background: #2d2d2d;
            color: #0f0;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“Š 06 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ - è¿½è¨˜å‹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
        <p>GitHubã«æ°¸ç¶šä¿å­˜ã•ã‚Œã‚‹è¿½è¨˜å‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆåˆæœŸåŒ–ãªã—ï¼‰</p>
    </div>

    <div class="stats">
        <div class="stat-card">
            <div class="stat-value" id="totalArticles">0</div>
            <div class="stat-label">ç·è¨˜äº‹æ•°</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="totalBatches">0</div>
            <div class="stat-label">ãƒãƒƒãƒæ•°</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="lastId">0</div>
            <div class="stat-label">æœ€çµ‚ID</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="dbSize">0 KB</div>
            <div class="stat-label">DB ã‚µã‚¤ã‚º</div>
        </div>
    </div>

    <div>
        <button onclick="loadManifest()">ğŸ“‹ ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆèª­è¾¼</button>
        <button onclick="loadBatch(1)">ğŸ“¦ ãƒãƒƒãƒ1èª­è¾¼</button>
        <button onclick="simulateNewBatch()">â• æ–°è¦ãƒãƒƒãƒè¿½åŠ ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆï¼‰</button>
        <button onclick="calculateCapacity()">ğŸ“Š å®¹é‡è¨ˆç®—</button>
        <button onclick="showAllBatches()">ğŸ“š å…¨ãƒãƒƒãƒè¡¨ç¤º</button>
    </div>

    <div id="log"></div>
    <div id="articles"></div>

    <script>
        let manifest = null;
        let currentBatch = null;

        function log(message, color = '#0f0') {
            const logEl = document.getElementById('log');
            const time = new Date().toLocaleTimeString('ja-JP');
            logEl.innerHTML += `<div style="color:${color}">[${time}] ${message}</div>`;
            logEl.scrollTop = logEl.scrollHeight;
        }

        async function loadManifest() {
            try {
                const response = await fetch('./manifest.json');
                manifest = await response.json();
                
                // çµ±è¨ˆæ›´æ–°
                document.getElementById('totalArticles').textContent = manifest.total_articles.toLocaleString();
                document.getElementById('totalBatches').textContent = manifest.total_batches;
                document.getElementById('lastId').textContent = manifest.last_article_id;
                
                // ã‚µã‚¤ã‚ºè¨ˆç®—ï¼ˆæ¦‚ç®—ï¼‰
                const sizeKB = Math.round(manifest.total_articles * 0.75); // 750 bytes/è¨˜äº‹
                document.getElementById('dbSize').textContent = 
                    sizeKB > 1024 ? `${(sizeKB/1024).toFixed(1)} MB` : `${sizeKB} KB`;
                
                log(`âœ… ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆèª­è¾¼å®Œäº†: ${manifest.total_articles}è¨˜äº‹ã€${manifest.total_batches}ãƒãƒƒãƒ`);
                
                // ãƒãƒƒãƒæƒ…å ±è¡¨ç¤º
                manifest.batches.forEach(batch => {
                    log(`  ãƒãƒƒãƒ${batch.id}: ID ${batch.start_id}-${batch.end_id} (${batch.count}ä»¶)`, '#ff0');
                });
            } catch (error) {
                log(`âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, '#f00');
            }
        }

        async function loadBatch(batchNum) {
            try {
                const batchFile = `data/batch_${String(batchNum).padStart(3, '0')}.json`;
                const response = await fetch('./' + batchFile);
                currentBatch = await response.json();
                
                log(`âœ… ãƒãƒƒãƒ${batchNum}èª­è¾¼: ${currentBatch.articles.length}ä»¶`);
                
                // æœ€åˆã®5ä»¶ã‚’è¡¨ç¤º
                const container = document.getElementById('articles');
                container.innerHTML = '<h3>è¨˜äº‹ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆæœ€åˆã®5ä»¶ï¼‰</h3>';
                currentBatch.articles.slice(0, 5).forEach(article => {
                    container.innerHTML += `
                        <div class="article">
                            <span class="article-id">#${article.id}</span>
                            <strong>${article.title}</strong><br>
                            ${article.description}<br>
                            <small>ğŸ“… ${article.date} | ğŸ“° ${article.source} | ğŸ·ï¸ ${article.category}</small>
                        </div>
                    `;
                });
            } catch (error) {
                log(`âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, '#f00');
            }
        }

        function simulateNewBatch() {
            if (!manifest) {
                log('âŒ å…ˆã«ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„', '#f00');
                return;
            }
            
            const newBatchId = manifest.total_batches + 1;
            const startId = manifest.last_article_id + 1;
            const endId = startId + 1499; // 1500ä»¶è¿½åŠ 
            
            log(`ğŸ“ æ–°è¦ãƒãƒƒãƒ${newBatchId}ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³:`, '#0ff');
            log(`  ãƒ•ã‚¡ã‚¤ãƒ«å: data/batch_${String(newBatchId).padStart(3, '0')}.json`);
            log(`  è¨˜äº‹IDç¯„å›²: ${startId} - ${endId}`);
            log(`  è¨˜äº‹æ•°: 1500ä»¶`);
            log(`  äºˆæƒ³ã‚µã‚¤ã‚º: ${(1500 * 0.75 / 1024).toFixed(1)} MB`);
            
            // æ›´æ–°å¾Œã®çµ±è¨ˆ
            const newTotal = manifest.total_articles + 1500;
            const newSizeMB = (newTotal * 0.75 / 1024).toFixed(1);
            log(`ğŸ“Š æ›´æ–°å¾Œã®çµ±è¨ˆ:`, '#ff0');
            log(`  ç·è¨˜äº‹æ•°: ${newTotal.toLocaleString()}ä»¶`);
            log(`  ç·ãƒãƒƒãƒæ•°: ${newBatchId}`);
            log(`  DBç·ã‚µã‚¤ã‚º: ${newSizeMB} MB`);
        }

        function calculateCapacity() {
            log('ğŸ“Š å®¹é‡è¨ˆç®—:', '#0ff');
            log('  1è¨˜äº‹ = ç´„750 bytes');
            log('  1ãƒãƒƒãƒ(1500è¨˜äº‹) = ç´„1.1 MB');
            log('');
            log('ğŸ“¦ ä¿å­˜å¯èƒ½é‡:', '#ff0');
            log('  å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«(æ¨å¥¨50MB): ç´„66,000è¨˜äº‹');
            log('  å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«(é™ç•Œ100MB): ç´„133,000è¨˜äº‹');
            log('  GitHubãƒªãƒã‚¸ãƒˆãƒª(1GB): ç´„1,300,000è¨˜äº‹');
            log('');
            log('âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹:', '#0f0');
            log('  ãƒãƒƒãƒåˆ†å‰²ã«ã‚ˆã‚Šã€å¿…è¦ãªéƒ¨åˆ†ã ã‘èª­è¾¼å¯èƒ½');
            log('  ä¾‹: æœ€æ–°1500ä»¶ = 1ãƒ•ã‚¡ã‚¤ãƒ«èª­è¾¼(1.1MB)');
            log('  å…¨10ä¸‡ä»¶ã§ã‚‚ã€ãƒãƒƒãƒå˜ä½ã§é«˜é€Ÿã‚¢ã‚¯ã‚»ã‚¹');
        }

        async function showAllBatches() {
            if (!manifest) {
                await loadManifest();
            }
            
            log('ğŸ“š å…¨ãƒãƒƒãƒä¸€è¦§:', '#0ff');
            for (const batch of manifest.batches) {
                log(`ãƒãƒƒãƒ${batch.id}: ${batch.file} (${batch.count}ä»¶)`);
            }
        }

        // åˆæœŸèª­è¾¼
        window.onload = () => {
            log('ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•', '#0ff');
            loadManifest();
        };
    </script>
</body>
</html>